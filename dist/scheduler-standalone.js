(function(){let w=window.location.search.includes("debug=true");function X(...q){if(w)console.log("[Scheduler Display]",...q)}let Q="sole_prop",O="round_robin",K={sole_prop:{url:"https://meetings.hubspot.com/bz/consultation",name:"Sole Proprietor Consultation",description:"For single-owner practices"},s_corp:{url:"https://meetings.hubspot.com/bz/consultations",name:"S-Corp Consultation",description:"For multi-owner practices"}};function A(q){try{let J=["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","does_your_practice_have_multiple_owners","multiple_owners","practice_multiple_owners","has_multiple_owners"],W=null;for(let $ of J)if(q&&q[$]){W=q[$];break}if(!W)return"sole_prop";let V=String(W).toLowerCase().trim();if(V==="yes"||V==="true")return"s_corp";if(V==="no"||V==="false")return"sole_prop";return"sole_prop"}catch(J){return"sole_prop"}}function z(){try{let q=localStorage.getItem("hubspot_form_data");if(q){let J=JSON.parse(q);return X("Found form data in localStorage"),{formData:J}}}catch(q){X("localStorage error:",q)}try{let q=sessionStorage.getItem("scheduler_router_data");if(q){let J=JSON.parse(q);return sessionStorage.removeItem("scheduler_router_data"),J}}catch(q){X("SessionStorage error:",q)}try{let q=(V)=>{let x=`; ${document.cookie}`.split(`; ${V}=`);if(x.length===2)return x.pop().split(";").shift()},J=q("scheduler_type"),W=q("form_data");if(J||W){let V=W?JSON.parse(atob(W)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",{scheduler_type:J,formData:V}}}catch(q){X("Cookie error:",q)}return null}function B(){let q={},J=new URLSearchParams(window.location.search);for(let[W,V]of J)q[W]=V;return q}function Y(q,J){let W=window.HubSpotRouter&&window.HubSpotRouter.config&&window.HubSpotRouter.config[q]||K[q]||K.sole_prop,V=new URL(W.url);return V.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([Z,M])=>{for(let j of M)if(J&&J[j]){V.searchParams.set(Z,J[j]),X(`Mapping ${j} -> ${Z}: ${J[j]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((Z)=>{if(J&&J[Z])V.searchParams.set(Z,J[Z])}),X("Built scheduler URL:",V.toString()),V.toString()}function v(q){try{if(typeof fbq!=="undefined")fbq("track","Lead",{content_category:"consultation",content_name:q+"_consultation"});if(typeof rdt!=="undefined")rdt("track","Lead",{customEventName:"ConsultationScheduler",schedulerType:q});if(typeof gtag!=="undefined")gtag("event","generate_lead",{event_category:"engagement",event_label:q+"_consultation"});else if(typeof ga!=="undefined")ga("send","event","Lead","Generate",q+"_consultation");if(typeof window.posthog!=="undefined")window.posthog.capture("scheduler_lead_generated",{scheduler_type:q});if(typeof window.amplitude!=="undefined")window.amplitude.track("scheduler_lead_generated",{scheduler_type:q});X("Lead events fired for:",q)}catch(J){X("Lead tracking error:",J)}}function H(){let q=document.getElementById("scheduler-target");if(!q){console.error('[Scheduler Display] No element with id="scheduler-target" found');return}let J=B(),W=z(),V={...J};if(W&&W.formData)V={...V,...W.formData};X("Params:",V),X("Forcing round-robin scheduler (ignoring scheduler_type)");let $=window.HubSpotRouter&&window.HubSpotRouter.config?window.HubSpotRouter.config:K,x=$[Q]||$.sole_prop,Z=window.HubSpotRouter&&typeof window.HubSpotRouter.buildSchedulerUrl==="function"?window.HubSpotRouter.buildSchedulerUrl(Q,V):Y(Q,V);X("Loading scheduler:",x&&x.name?x.name:"Round Robin"),X("URL:",Z),q.innerHTML=`<div class="meetings-iframe-container" data-src="${Z}"></div>`;let M=document.createElement("script");M.src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js",M.onload=function(){X("Scheduler loaded"),v(O)},M.onerror=function(){console.error("[Scheduler Display] Failed to load scheduler")},document.head.appendChild(M)}function b(){H()}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",b);else b();if(w)window.SchedulerDisplay={getRouterData:z,getQueryParams:B,determineSchedulerTypeFallback:A,buildSchedulerUrl:Y,fireLeadEvents:v,injectScheduler:H,init:b}})();
