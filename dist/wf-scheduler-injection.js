(function(){let M=window.location.search.includes("debug=true");function J(...j){if(M)console.log("[Webflow Scheduler]",...j)}let R={sole_prop:{url:"https://meetings.hubspot.com/bz/consultation",name:"Round Robin Consultation",description:"For all practices (round-robin)"}};function V(){try{let j=localStorage.getItem("hubspot_form_data");if(j){let K=JSON.parse(j);return J("Found form data in localStorage:",K),{formData:K,source:"localStorage"}}}catch(j){J("localStorage error:",j)}try{let j=sessionStorage.getItem("scheduler_router_data");if(j){let K=JSON.parse(j);return J("Found router data in sessionStorage:",K),sessionStorage.removeItem("scheduler_router_data"),{formData:K.formData,schedulerType:K.scheduler_type,source:"sessionStorage"}}}catch(j){J("sessionStorage error:",j)}try{let j=(X)=>{let Z=`; ${document.cookie}`.split(`; ${X}=`);if(Z.length===2)return Z.pop().split(";").shift()},K=j("scheduler_type"),q=j("form_data");if(K||q){let X=q?JSON.parse(atob(q)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",J("Found data in cookies:",{schedulerType:K,formData:X}),{formData:X,schedulerType:K,source:"cookies"}}}catch(j){J("cookie error:",j)}return null}function _(){let j={},K=new URLSearchParams(window.location.search);for(let[q,X]of K)j[q]=X;return j}function v(j){let K=R.sole_prop,q=new URL(K.url);q.searchParams.set("embed","true");let X=j.partnerstack_click_id||j.ps_xid||j["0-1/partnerstack_click_id"]||j["0-2/partnerstack_click_id"];if(X)q.searchParams.set("partnerstack_click_id",X),J("Adding PartnerStack click id",X);return Object.entries({email:["email","email_address","0-1/email","0-2/email"],firstname:["firstname","first_name","fname","0-1/firstname","0-2/firstname"],lastname:["lastname","last_name","lname","0-1/lastname","0-2/lastname"],company:["company","practice_name","business_name","0-1/company","0-2/company"],phone:["phone","phone_number","telephone","0-1/phone","0-2/phone"]}).forEach(([z,$])=>{for(let W of $)if(j[W]){q.searchParams.set(z,j[W]),J(`Mapping ${W} -> ${z}: ${j[W]}`);break}}),["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","what_best_describes_your_practice_","referrer","submissionGuid","uuid","partnerstack_click_id"].forEach((z)=>{if(j[z])q.searchParams.set(z,j[z]),J(`Adding additional field: ${z} = ${j[z]}`);else{let $=[`0-1/${z}`,`0-2/${z}`];for(let W of $)if(j[W]){q.searchParams.set(z,j[W]),J(`Adding prefixed field: ${W} -> ${z} = ${j[W]}`);break}}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((z)=>{if(j[z])q.searchParams.set(z,j[z])}),J("Built scheduler URL:",q.toString()),q.toString()}function B(){try{if(window.location.hostname.includes("joinheard.com")){if(typeof rdt==="function")rdt("track","Lead");if(typeof fbq==="function")fbq("track","Lead")}if(typeof gtag<"u")gtag("event","generate_lead",{event_category:"engagement",event_label:"round_robin_consultation"});else if(typeof ga<"u")ga("send","event","Lead","Generate","round_robin_consultation");if(typeof window.posthog<"u")window.posthog.capture("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});if(typeof window.amplitude<"u")window.amplitude.track("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});J("Lead events fired")}catch(j){J("Lead tracking error:",j)}}function H(){J("Starting scheduler setup...");let j=_(),K=V(),q={...j};if(K&&K.formData)q={...q,...K.formData},J("Merged form data from storage:",q);if(!(q.email||q.firstname||q.first_name||q["0-1/email"]||q["0-1/firstname"]||q["0-2/email"]||q["0-2/firstname"]||Object.keys(q).some((z)=>z!=="debug"&&z!=="utm_source"&&z!=="utm_medium"&&z!=="utm_campaign"&&!z.startsWith("group[")&&q[z]))){J("No form data found, redirecting to /free-consult"),window.location.href="/free-consult";return}J("Form data found, setting up scheduler");let Y=document.getElementById("scheduler-target");if(!Y){let z=document.querySelector('iframe[src*="meetings.hubspot.com"]'),$=document.querySelector(".meetings-iframe-container");if(z||$){J("Found existing iframe/container, will enhance it");let W=document.createElement("div");if(W.id="scheduler-target",$)$.parentNode.insertBefore(W,$),W.appendChild($);else if(z)z.parentNode.insertBefore(W,z),W.appendChild(z);Y=W}}if(!Y)J("No target found, creating scheduler-target div"),Y=document.createElement("div"),Y.id="scheduler-target",Y.style.cssText="min-height: 600px; width: 100%;",document.body.appendChild(Y);let Z=v(q);J("Injecting scheduler into target"),J("Final URL:",Z),Y.innerHTML=`<div class="meetings-iframe-container" data-src="${Z}"></div>`;let A=document.createElement("script");return A.src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js",A.onload=function(){J("HubSpot embed script loaded successfully"),B()},A.onerror=function(){console.error("[Webflow Scheduler] Failed to load HubSpot embed script")},document.head.appendChild(A),!0}function T(){if(!M)return;let j=document.createElement("div");j.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      border: 2px solid #226752;
    `;let K=V(),q=new URLSearchParams(window.location.search);j.innerHTML=`
      <strong>\uD83D\uDD27 Webflow Scheduler Debug</strong><br><br>
      <strong>Form Data Sources:</strong><br>
      \uD83D\uDCC1 localStorage: ${localStorage.getItem("hubspot_form_data")?"✅ Found":"❌ Empty"}<br>
      \uD83D\uDCBE sessionStorage: ${sessionStorage.getItem("scheduler_router_data")?"✅ Found":"❌ Empty"}<br>
      \uD83C\uDF6A Cookies: ${document.cookie.includes("form_data=")?"✅ Found":"❌ Empty"}<br><br>
      <strong>URL Parameters:</strong><br>
      ${q.toString()||"None"}<br><br>
      <strong>Stored Data:</strong><br>
      ${K?`Source: ${K.source}<br>Fields: ${Object.keys(K.formData||{}).join(", ")}`:"None found"}<br><br>
      <strong>Action:</strong><br>
      ${K||q.toString()?"✅ Loading scheduler":"❌ Will redirect to /free-consult"}
    `,document.body.appendChild(j);let X=!1,Y={x:0,y:0};j.addEventListener("mousedown",(Z)=>{X=!0,Y.x=Z.clientX-j.offsetLeft,Y.y=Z.clientY-j.offsetTop}),document.addEventListener("mousemove",(Z)=>{if(X)j.style.left=Z.clientX-Y.x+"px",j.style.top=Z.clientY-Y.y+"px",j.style.right="auto"}),document.addEventListener("mouseup",()=>{X=!1})}function Q(){J("Webflow Scheduler Complete initializing..."),T(),H(),J("Webflow Scheduler Complete initialized")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Q);else Q();if(M)window.WebflowSchedulerComplete={getStoredFormData:V,getQueryParams:_,buildSchedulerUrl:v,handleScheduler:H,fireLeadEvents:B,init:Q,config:R};J("Webflow Scheduler Complete script loaded")})();
