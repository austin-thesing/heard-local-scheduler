(function(){let Y={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},L={success:"/thank-you/success",schedule:"/thank-you/schedule"},X=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],w=["yes","true","y","1","multiple owners","multi"],P=["no","false","n","0"];function z(J){if(J==null)return"";return String(J).trim().toLowerCase()}function U(J){let W=z(J);if(!W)return!1;if(w.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function p(J){let W=z(J);if(!W)return!1;if(P.includes(W))return!0;return W.startsWith("no")}function C(J,W){if(!J)return null;for(let $ of W){if(J[$])return J[$];let q=[`0-1/${$}`,`0-2/${$}`,`0-3/${$}`];for(let Z of q)if(J[Z])return J[Z]}return null}let A=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function B(...J){if(A)console.log("[HubSpot Router]",...J)}let k="partnerstack_click_id",N=["ps_xid","psx_id"],g=["ps_xid","psx_id"];function T(J){try{if(!document.cookie)return null;let W=document.cookie.split(";");for(let $ of W){let q=$.trim();if(!q)continue;if(q.startsWith(`${J}=`)){let[,Z]=q.split("=");if(Z)return decodeURIComponent(Z)}}}catch(W){B(`cookie access error for ${J}:`,W)}return null}function y(){let J=[];for(let q of g){let Z=T(q);if(Z)B("Found PartnerStack ID in cookie",q+":",Z),J.push(Z)}try{if(window.partnerstack&&window.partnerstack.ps_xid)B("Found PartnerStack ID in window.partnerstack:",window.partnerstack.ps_xid),J.push(window.partnerstack.ps_xid)}catch(q){B("Partnerstack global lookup error:",q)}try{if(window.ps_xid)B("Found PartnerStack ID in window.ps_xid:",window.ps_xid),J.push(window.ps_xid)}catch(q){B("ps_xid global lookup error:",q)}try{N.forEach((q)=>{let Z=localStorage.getItem(q);if(Z)B("Found PartnerStack ID in localStorage",q+":",Z),J.push(Z)})}catch(q){B("localStorage access error for partnerstack id:",q)}try{N.forEach((q)=>{let Z=sessionStorage.getItem(q);if(Z)B("Found PartnerStack ID in sessionStorage",q+":",Z),J.push(Z)})}catch(q){B("sessionStorage access error for partnerstack id:",q)}let W=T(k);if(W&&!J.includes(W))B("Found PartnerStack ID in partnerstack_click_id cookie:",W),J.push(W);B("All PartnerStack ID candidates:",J);let $=J.find((q)=>q&&q!=="undefined"&&q!=="null");return B("Resolved PartnerStack ID:",$),$||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=A;let K=!1;function V(J){try{if(!J)return"";let W=String(J);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return J}}function v(J){let W={};if(!J)return W;if(Array.isArray(J))return J.forEach(($)=>{if(!$)return;let q=$.name||$.field||"",Z=V(q),j=typeof $.value==="string"?$.value:Array.isArray($.value)?$.value[0]:$.value!=null?String($.value):"";if(q)W[q]=j;if(Z&&Z!==q)W[Z]=j}),W;if(J.fields){let $=J.fields;if(Array.isArray($))$.forEach((q)=>{if(!q)return;let Z=q.name||q.field||"",j=V(Z),Q=typeof q.value==="string"?q.value:Array.isArray(q.value)?q.value[0]:q.value!=null?String(q.value):"";if(Z)W[Z]=Q;if(j&&j!==Z)W[j]=Q});else if(typeof $==="object")Object.entries($).forEach(([q,Z])=>{let j=V(q),Q=typeof Z==="string"?Z:Array.isArray(Z)?Z[0]:Z!=null?String(Z):"";if(W[q]=Q,j&&j!==q)W[j]=Q});return W}return Object.entries(J).forEach(([$,q])=>{let Z=V($),j=typeof q==="string"?q:Array.isArray(q)?q[0]:q!=null?String(q):"";if(W[$]=j,Z&&Z!==$)W[Z]=j}),W}function F(J){let W=C(J,X),$=W&&U(W);if(!$)return B("Multi-practice question not answered yes, routing to success page",{field:X.find((q)=>J[q]),value:W,hasYes:$}),"success";return B("Multi-practice question answered yes, routing to scheduler",{multiPracticeValue:W}),"general"}function S(J,W){let $=Y[J]||Y.general,q=new URL($.url);return q.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([Q,x])=>{for(let H of x)if(W[H]){q.searchParams.set(Q,W[H]),B(`Mapping ${H} -> ${Q}: ${W[H]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((Q)=>{if(W[Q])q.searchParams.set(Q,W[Q])}),B("Built scheduler URL:",q.toString()),q.toString()}function D(J,W){if(W==="success"){let j=new URLSearchParams;if(J.email)j.set("email",J.email);let Q=`${L.success}${j.toString()?"?"+j.toString():""}`;B("Redirecting to success page for soft rejection:",Q);try{window.location.replace(Q)}catch(x){B("replace() failed, using href for success redirect",x),window.location.href=Q}return}let $={scheduler_type:W,formData:J,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify($)),B("Stored router data in sessionStorage")}catch(j){B("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(J))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(J)),B("Stored form data in localStorage for prefill")}catch(j){B("Failed to store form data in localStorage:",j)}let q=new URLSearchParams;if(J.email)q.set("email",J.email);let Z=`${L.schedule}${q.toString()?"?"+q.toString():""}`;B("Redirecting to:",Z);try{window.location.replace(Z)}catch(j){B("replace() failed, using href for scheduler redirect",j),window.location.href=Z}}function b(J,W={}){if(B("Form submission detected:",J),K){B("Routing already performed; skipping");return}K=!0;let $=y();if($){J.partnerstack_click_id=$,J["0-1/partnerstack_click_id"]=$,J["0-2/partnerstack_click_id"]=$,J["0-3/partnerstack_click_id"]=$,B("Injected PartnerStack ID into submission:",$);try{sessionStorage.setItem("ps_xid",$)}catch(Z){B("Failed to persist partnerstack id in sessionStorage:",Z)}try{localStorage.setItem("ps_xid",$)}catch(Z){B("Failed to persist partnerstack id in localStorage:",Z)}}let q=F(J);if(D(J,q),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:q,has_email:!!J.email,has_name:!!(J.firstname||J.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:q,method:"redirect"})}function c(){window._capturedFormData=window._capturedFormData||{};let J={},W=new WeakSet;function $(Z,j="change"){if(!Z.name)return;let Q=Z.name,x=V(Q),H=Z.value,G=H;if(Z.type==="radio"){let M=Z.closest("label");if(M&&M.textContent){let O=M.textContent.replace(/\s+/g," ").trim();if(O)G=O}}if(J[Q]===G)return;if(J[Q]=G,Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(window._capturedFormData[Q]=G,x&&x!==Q)window._capturedFormData[x]=G;if(Z.type==="radio"){if(window._capturedFormData[`${Q}_raw`]=H,x&&x!==Q)window._capturedFormData[`${x}_raw`]=H;let M=document.querySelector(`input[type="hidden"][name="${Q}"]`);if(M&&M.value){if(window._capturedFormData[Q]=M.value,x&&x!==Q)window._capturedFormData[x]=M.value;G=M.value}}if(G){let M=Z.type||Z.tagName.toLowerCase();if(Z.type==="tel"||Q.toLowerCase().includes("phone")){let O=G.replace(/[\s\-\(\)\.]/g,"");if(O)window._capturedFormData[Q+"_clean"]=O;B("Captured phone:",Q,"=",G)}else if(Z.type==="radio")B("Captured radio selection:",Q,"=",G,"(raw:",H,")");else if(Z.type==="hidden"){if(Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(Z.closest(".hsfc-DropdownField"))B("Captured dropdown:",Q,"=",G);else B("Captured field:",Q,"=",G)}else B("Captured",M+":",Q,"=",G)}}function q(){let Z=new MutationObserver((Q)=>{let x=[];if(Q.forEach((H)=>{H.addedNodes.forEach((G)=>{if(G.nodeType===1)x.push(G)})}),x.length===0)return;x.forEach((H)=>{let G=H.querySelectorAll?H.querySelectorAll("input[name], select[name], textarea[name]"):[];if(H.tagName&&(H.tagName==="INPUT"||H.tagName==="SELECT"||H.tagName==="TEXTAREA")&&H.name)j(H);G.forEach((M)=>j(M))})});function j(Q){if(W.has(Q))return;if(W.add(Q),Q.readOnly&&Q.type!=="hidden")return;if(Q.type==="hidden"&&Q.name){let x=Q.value,H=setInterval(()=>{if(Q.value!==x)x=Q.value,$(Q,"programmatic");if(!document.body.contains(Q))clearInterval(H)},500);if(Q.value)$(Q,"initial")}else if(Q.type==="radio")Q.addEventListener("change",()=>$(Q));else if(Q.type==="tel"||Q.name&&Q.name.toLowerCase().includes("phone"))Q.addEventListener("blur",()=>$(Q)),Q.addEventListener("change",()=>$(Q));else if(Q.addEventListener("change",()=>$(Q)),Q.addEventListener("blur",()=>$(Q)),Q.value)$(Q,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(j),Z.observe(document.body,{childList:!0,subtree:!0}),B("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",q);else q()}function f(J){if(!J)return!1;let W=!!C(J,X);return Boolean(J.email||J.firstname||J.first_name||J.lastname||J.last_name||J.company||J.practice_name)||W}function s(J={}){B("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function(Q){try{let x=new URL(Q).hostname;return x.endsWith("hubspot.com")||x.endsWith("hsforms.com")||x.endsWith("hsforms.net")||x.endsWith("hsappstatic.net")||x.includes("hubspot")||x.includes("hsforms")}catch(x){return!1}}(W.origin))return;let q=W.data;if(typeof q==="string")try{q=JSON.parse(q)}catch(Q){}B("Received message from HubSpot:",q);let Z=q&&(q.type||q.messageType),j=q&&q.eventName;if(q&&Z==="hsFormCallback"&&(j==="onFormSubmitted"||j==="onFormSubmit")){let Q=q&&q.data?v(q.data):{},H={...window._capturedFormData&&typeof window._capturedFormData==="object"?window._capturedFormData:{},...Q};if(!f(H)){if(j==="onFormSubmit")B("onFormSubmit received without routing fields; waiting for onFormSubmitted event");else B("Submission payload lacks routing data; skipping redirect");return}try{window._capturedFormData={...H}}catch(M){B("Failed to persist merged submission data globally:",M)}let G={...J,formGuid:q.data?.formGuid||q.formGuid,portalId:q.data?.portalId||q.portalId};b(H,G)}else if(q&&q.formGuid&&q.accepted===!0){if(B("Developer embed submission detected"),B("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),B("Stored captured form data in localStorage for prefill")}catch(x){B("Failed to store captured form data in localStorage:",x)}let Q={...J,formGuid:q.formGuid,portalId:q.portalId};b(window._capturedFormData,Q)}}else if(q&&Z==="hsFormCallback"&&A)B("Ignoring hsFormCallback event:",j)}),B("PostMessage listener initialized")}function R(J={}){let $={...{redirect:!0,debug:A},...J};if($.debug)window.HubSpotRouterDebug={config:Y,determineSchedulerType:F,buildSchedulerUrl:S,handleFormSubmission:b},B("Debug mode enabled. Access via window.HubSpotRouterDebug");c(),s($),B("HubSpot Form Router initialized with config:",$)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>R());else R();window.HubSpotRouter={...window.HubSpotRouter,init:R,handleFormSubmission:b,determineSchedulerType:F,buildSchedulerUrl:S,config:Y,DEBUG:A},B("HubSpot Form Router loaded")})();function m(Y){if(console.log("[PartnerStack] getCookie called with name:",Y),!Y||typeof Y!=="string")return console.log("[PartnerStack] getCookie: invalid name parameter"),null;try{let L=new RegExp("(?:^|; )"+Y.replace(/([.$?*|{}()[\]\\/+^])/g,"\\$1")+"=([^;]*)"),X=document.cookie.match(L),w=X?decodeURIComponent(X[1]):null;return console.log("[PartnerStack] getCookie result for",Y+":",w),w}catch(L){return console.warn("[PartnerStack] getCookie error:",L),null}}function E(){console.log("[PartnerStack] getPartnerStackId called");var Y=null;try{if(typeof sessionStorage<"u")console.log("[PartnerStack] Checking sessionStorage for ps_xid"),Y=sessionStorage.getItem("ps_xid"),console.log("[PartnerStack] sessionStorage ps_xid:",Y);else console.log("[PartnerStack] sessionStorage not available")}catch(L){console.warn("[PartnerStack] sessionStorage access error:",L),Y=null}if(!Y)try{if(typeof localStorage<"u")console.log("[PartnerStack] Checking localStorage for ps_xid"),Y=localStorage.getItem("ps_xid"),console.log("[PartnerStack] localStorage ps_xid:",Y);else console.log("[PartnerStack] localStorage not available")}catch(L){console.warn("[PartnerStack] localStorage access error:",L),Y=null}if(!Y)console.log("[PartnerStack] Falling back to cookie"),Y=m("ps_xid");return console.log("[PartnerStack] Final PartnerStack ID:",Y),Y}function _(){console.log("[PartnerStack] injectPartnerStackId called");let Y=E();if(!Y){console.log("[PartnerStack] No PartnerStack ID available, skipping injection");return}console.log("[PartnerStack] Injecting PartnerStack ID:",Y);let L=['input[name="partnerstack_click_id"]','input[name$="/partnerstack_click_id"]','input[name="ps_xid"]','input[name$="/ps_xid"]'];console.log("[PartnerStack] Searching for fields with selectors:",L);let X=document.querySelectorAll(L.join(", "));console.log("[PartnerStack] Found",X.length,"potential input fields"),X.forEach(function(w,P){if(console.log("[PartnerStack] Processing field",P+1,"- name:",w.name,"current value:",w.value),w&&!w.value)try{console.log("[PartnerStack] Injecting into field:",w.name),w.value=Y,w.setAttribute("value",Y);let z=new Event("input",{bubbles:!0}),U=new Event("change",{bubbles:!0});w.dispatchEvent(z),w.dispatchEvent(U),console.log("[PartnerStack] Successfully injected ID into field:",w.name)}catch(z){console.warn("[PartnerStack] Failed to inject into field:",w.name,z)}else console.log("[PartnerStack] Skipping field:",w.name,"- reason:",w.value?"already has value":"invalid element")})}function d(){if(console.log("[PartnerStack] setupHubSpotListener called"),!window.hbspt||!window.hbspt.forms){console.log("[PartnerStack] HubSpot forms library not available, skipping listener setup");return}console.log("[PartnerStack] HubSpot forms library detected, setting up message listener"),window.addEventListener("message",function(Y){console.log("[PartnerStack] Received message event:",Y.data);try{if(Y.data&&Y.data.type==="hsFormCallback"){let X=Y.data.eventName;if(console.log("[PartnerStack] HubSpot form callback received:",X),X==="onFormReady")console.log("[PartnerStack] Form ready event detected, scheduling injection in 100ms"),setTimeout(_,100)}else console.log("[PartnerStack] Ignoring non-HubSpot message:",Y.data?Y.data.type:"no type")}catch(L){console.warn("[PartnerStack] Error processing message event:",L)}})}function I(){console.log("[PartnerStack] Initializing PartnerStack cookie helper"),console.log("[PartnerStack] Current document readyState:",document.readyState),console.log("[PartnerStack] Attempting immediate injection"),_(),console.log("[PartnerStack] Setting up HubSpot listeners"),d(),console.log("[PartnerStack] Scheduling delayed injections at 1s and 3s"),setTimeout(function(){console.log("[PartnerStack] Running 1-second delayed injection"),_()},1000),setTimeout(function(){console.log("[PartnerStack] Running 3-second delayed injection"),_()},3000)}window.getPartnerStackId=E;window.injectPartnerStackId=_;console.log("[PartnerStack] Checking DOM readyState for initialization:",document.readyState);if(document.readyState==="loading")console.log("[PartnerStack] DOM still loading, waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",function(){console.log("[PartnerStack] DOMContentLoaded fired, starting initialization"),I()});else console.log("[PartnerStack] DOM already loaded, starting initialization immediately"),I();var h={get router(){return window.HubSpotRouter||{}},get cookieHelper(){return{getPartnerStackId:typeof window.getPartnerStackId==="function"?window.getPartnerStackId:null,injectPartnerStackId:typeof window.injectPartnerStackId==="function"?window.injectPartnerStackId:null}},initialized:!0,version:"1.0.0"};window.HubSpotFormsComplete=h;var o=h;export{o as default};
