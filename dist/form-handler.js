(function(){let B={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},M={success:"/thank-you/success",schedule:"/thank-you/schedule"},w=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],L=["yes","true","y","1","multiple owners","multi"],b=["no","false","n","0"];function z(J){if(J==null)return"";return String(J).trim().toLowerCase()}function U(J){let W=z(J);if(!W)return!1;if(L.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function p(J){let W=z(J);if(!W)return!1;if(b.includes(W))return!0;return W.startsWith("no")}function C(J,W){if(!J)return null;for(let $ of W){if(J[$])return J[$];let q=[`0-1/${$}`,`0-2/${$}`,`0-3/${$}`];for(let Z of q)if(J[Z])return J[Z]}return null}let A=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function j(...J){if(A)console.log("[HubSpot Router]",...J)}let h="partnerstack_click_id",N=["ps_xid","psx_id"],k=["ps_xid","psx_id"];function S(J){try{if(!document.cookie)return null;let W=document.cookie.split(";");for(let $ of W){let q=$.trim();if(!q)continue;if(q.startsWith(`${J}=`)){let[,Z]=q.split("=");if(Z)return decodeURIComponent(Z)}}}catch(W){j(`cookie access error for ${J}:`,W)}return null}function g(){let J=[];for(let q of k){let Z=S(q);if(Z)j("Found PartnerStack ID in cookie",q+":",Z),J.push(Z)}try{if(window.partnerstack&&window.partnerstack.ps_xid)j("Found PartnerStack ID in window.partnerstack:",window.partnerstack.ps_xid),J.push(window.partnerstack.ps_xid)}catch(q){j("Partnerstack global lookup error:",q)}try{if(window.ps_xid)j("Found PartnerStack ID in window.ps_xid:",window.ps_xid),J.push(window.ps_xid)}catch(q){j("ps_xid global lookup error:",q)}try{N.forEach((q)=>{let Z=localStorage.getItem(q);if(Z)j("Found PartnerStack ID in localStorage",q+":",Z),J.push(Z)})}catch(q){j("localStorage access error for partnerstack id:",q)}try{N.forEach((q)=>{let Z=sessionStorage.getItem(q);if(Z)j("Found PartnerStack ID in sessionStorage",q+":",Z),J.push(Z)})}catch(q){j("sessionStorage access error for partnerstack id:",q)}let W=S(h);if(W&&!J.includes(W))j("Found PartnerStack ID in partnerstack_click_id cookie:",W),J.push(W);j("All PartnerStack ID candidates:",J);let $=J.find((q)=>q&&q!=="undefined"&&q!=="null");return j("Resolved PartnerStack ID:",$),$||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=A;let I=!1;function V(J){try{if(!J)return"";let W=String(J);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return J}}function y(J){let W={};if(!J)return W;if(Array.isArray(J))return J.forEach(($)=>{if(!$)return;let q=$.name||$.field||"",Z=V(q),Y=typeof $.value==="string"?$.value:Array.isArray($.value)?$.value[0]:$.value!=null?String($.value):"";if(q)W[q]=Y;if(Z&&Z!==q)W[Z]=Y}),W;if(J.fields){let $=J.fields;if(Array.isArray($))$.forEach((q)=>{if(!q)return;let Z=q.name||q.field||"",Y=V(Z),Q=typeof q.value==="string"?q.value:Array.isArray(q.value)?q.value[0]:q.value!=null?String(q.value):"";if(Z)W[Z]=Q;if(Y&&Y!==Z)W[Y]=Q});else if(typeof $==="object")Object.entries($).forEach(([q,Z])=>{let Y=V(q),Q=typeof Z==="string"?Z:Array.isArray(Z)?Z[0]:Z!=null?String(Z):"";if(W[q]=Q,Y&&Y!==q)W[Y]=Q});return W}return Object.entries(J).forEach(([$,q])=>{let Z=V($),Y=typeof q==="string"?q:Array.isArray(q)?q[0]:q!=null?String(q):"";if(W[$]=Y,Z&&Z!==$)W[Z]=Y}),W}function F(J){let W=C(J,w),$=W&&U(W);if(!$)return j("Multi-practice question not answered yes, routing to success page",{field:w.find((q)=>J[q]),value:W,hasYes:$}),"success";return j("Multi-practice question answered yes, routing to scheduler",{multiPracticeValue:W}),"general"}function T(J,W){let $=B[J]||B.general,q=new URL($.url);return q.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([Q,x])=>{for(let H of x)if(W[H]){q.searchParams.set(Q,W[H]),j(`Mapping ${H} -> ${Q}: ${W[H]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((Q)=>{if(W[Q])q.searchParams.set(Q,W[Q])}),j("Built scheduler URL:",q.toString()),q.toString()}function v(J,W){if(W==="success"){let Y=new URLSearchParams;if(J.email)Y.set("email",J.email);let Q=`${M.success}${Y.toString()?"?"+Y.toString():""}`;j("Redirecting to success page for soft rejection:",Q);try{window.location.replace(Q)}catch(x){j("replace() failed, using href for success redirect",x),window.location.href=Q}return}let $={scheduler_type:W,formData:J,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify($)),j("Stored router data in sessionStorage")}catch(Y){j("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(J))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(J)),j("Stored form data in localStorage for prefill")}catch(Y){j("Failed to store form data in localStorage:",Y)}let q=new URLSearchParams;if(J.email)q.set("email",J.email);let Z=`${M.schedule}${q.toString()?"?"+q.toString():""}`;j("Redirecting to:",Z);try{window.location.replace(Z)}catch(Y){j("replace() failed, using href for scheduler redirect",Y),window.location.href=Z}}function P(J,W={}){if(j("Form submission detected:",J),I){j("Routing already performed; skipping");return}I=!0;let $=g();if($){J.partnerstack_click_id=$,J["0-1/partnerstack_click_id"]=$,J["0-2/partnerstack_click_id"]=$,J["0-3/partnerstack_click_id"]=$,j("Injected PartnerStack ID into submission:",$);try{sessionStorage.setItem("ps_xid",$)}catch(Z){j("Failed to persist partnerstack id in sessionStorage:",Z)}try{localStorage.setItem("ps_xid",$)}catch(Z){j("Failed to persist partnerstack id in localStorage:",Z)}}let q=F(J);if(v(J,q),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:q,has_email:!!J.email,has_name:!!(J.firstname||J.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:q,method:"redirect"})}function D(){window._capturedFormData=window._capturedFormData||{};let J={},W=new WeakSet;function $(Z,Y="change"){if(!Z.name)return;let Q=Z.name,x=V(Q),H=Z.value,G=H;if(Z.type==="radio"){let X=Z.closest("label");if(X&&X.textContent){let O=X.textContent.replace(/\s+/g," ").trim();if(O)G=O}}if(J[Q]===G)return;if(J[Q]=G,Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(window._capturedFormData[Q]=G,x&&x!==Q)window._capturedFormData[x]=G;if(Z.type==="radio"){if(window._capturedFormData[`${Q}_raw`]=H,x&&x!==Q)window._capturedFormData[`${x}_raw`]=H;let X=document.querySelector(`input[type="hidden"][name="${Q}"]`);if(X&&X.value){if(window._capturedFormData[Q]=X.value,x&&x!==Q)window._capturedFormData[x]=X.value;G=X.value}}if(G){let X=Z.type||Z.tagName.toLowerCase();if(Z.type==="tel"||Q.toLowerCase().includes("phone")){let O=G.replace(/[\s\-\(\)\.]/g,"");if(O)window._capturedFormData[Q+"_clean"]=O;j("Captured phone:",Q,"=",G)}else if(Z.type==="radio")j("Captured radio selection:",Q,"=",G,"(raw:",H,")");else if(Z.type==="hidden"){if(Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(Z.closest(".hsfc-DropdownField"))j("Captured dropdown:",Q,"=",G);else j("Captured field:",Q,"=",G)}else j("Captured",X+":",Q,"=",G)}}function q(){let Z=new MutationObserver((Q)=>{let x=[];if(Q.forEach((H)=>{H.addedNodes.forEach((G)=>{if(G.nodeType===1)x.push(G)})}),x.length===0)return;x.forEach((H)=>{let G=H.querySelectorAll?H.querySelectorAll("input[name], select[name], textarea[name]"):[];if(H.tagName&&(H.tagName==="INPUT"||H.tagName==="SELECT"||H.tagName==="TEXTAREA")&&H.name)Y(H);G.forEach((X)=>Y(X))})});function Y(Q){if(W.has(Q))return;if(W.add(Q),Q.readOnly&&Q.type!=="hidden")return;if(Q.type==="hidden"&&Q.name){let x=Q.value,H=setInterval(()=>{if(Q.value!==x)x=Q.value,$(Q,"programmatic");if(!document.body.contains(Q))clearInterval(H)},500);if(Q.value)$(Q,"initial")}else if(Q.type==="radio")Q.addEventListener("change",()=>$(Q));else if(Q.type==="tel"||Q.name&&Q.name.toLowerCase().includes("phone"))Q.addEventListener("blur",()=>$(Q)),Q.addEventListener("change",()=>$(Q));else if(Q.addEventListener("change",()=>$(Q)),Q.addEventListener("blur",()=>$(Q)),Q.value)$(Q,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(Y),Z.observe(document.body,{childList:!0,subtree:!0}),j("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",q);else q()}function c(J){if(!J)return!1;let W=!!C(J,w);return Boolean(J.email||J.firstname||J.first_name||J.lastname||J.last_name||J.company||J.practice_name)||W}function f(J={}){j("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function(Q){try{let x=new URL(Q).hostname;return x.endsWith("hubspot.com")||x.endsWith("hsforms.com")||x.endsWith("hsforms.net")||x.endsWith("hsappstatic.net")||x.includes("hubspot")||x.includes("hsforms")}catch(x){return!1}}(W.origin))return;let q=W.data;if(typeof q==="string")try{q=JSON.parse(q)}catch(Q){}j("Received message from HubSpot:",q);let Z=q&&(q.type||q.messageType),Y=q&&q.eventName;if(q&&Z==="hsFormCallback"&&(Y==="onFormSubmitted"||Y==="onFormSubmit")){let Q=q&&q.data?y(q.data):{},x=window._capturedFormData&&typeof window._capturedFormData==="object"?window._capturedFormData:{},H={...Q,...x};if(!c(H)){if(Y==="onFormSubmit")j("onFormSubmit received without routing fields; waiting for onFormSubmitted event");else j("Submission payload lacks routing data; skipping redirect");return}try{window._capturedFormData={...H}}catch(X){j("Failed to persist merged submission data globally:",X)}let G={...J,formGuid:q.data?.formGuid||q.formGuid,portalId:q.data?.portalId||q.portalId};P(H,G)}else if(q&&q.formGuid&&q.accepted===!0){if(j("Developer embed submission detected"),j("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),j("Stored captured form data in localStorage for prefill")}catch(x){j("Failed to store captured form data in localStorage:",x)}let Q={...J,formGuid:q.formGuid,portalId:q.portalId};P(window._capturedFormData,Q)}}else if(q&&Z==="hsFormCallback"&&A)j("Ignoring hsFormCallback event:",Y)}),j("PostMessage listener initialized")}function R(J={}){let $={...{redirect:!0,debug:A},...J};if($.debug)window.HubSpotRouterDebug={config:B,determineSchedulerType:F,buildSchedulerUrl:T,handleFormSubmission:P},j("Debug mode enabled. Access via window.HubSpotRouterDebug");D(),f($),j("HubSpot Form Router initialized with config:",$)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>R());else R();window.HubSpotRouter={...window.HubSpotRouter,init:R,handleFormSubmission:P,determineSchedulerType:F,buildSchedulerUrl:T,config:B,DEBUG:A},j("HubSpot Form Router loaded")})();function s(B){if(console.log("[PartnerStack] getCookie called with name:",B),!B||typeof B!=="string")return console.log("[PartnerStack] getCookie: invalid name parameter"),null;try{let M=new RegExp("(?:^|; )"+B.replace(/([.$?*|{}()[\]\\/+^])/g,"\\$1")+"=([^;]*)"),w=document.cookie.match(M),L=w?decodeURIComponent(w[1]):null;return console.log("[PartnerStack] getCookie result for",B+":",L),L}catch(M){return console.warn("[PartnerStack] getCookie error:",M),null}}function m(){console.log("[PartnerStack] getPartnerStackId called");var B=null;try{if(typeof sessionStorage<"u")console.log("[PartnerStack] Checking sessionStorage for ps_xid"),B=sessionStorage.getItem("ps_xid"),console.log("[PartnerStack] sessionStorage ps_xid:",B);else console.log("[PartnerStack] sessionStorage not available")}catch(M){console.warn("[PartnerStack] sessionStorage access error:",M),B=null}if(!B)try{if(typeof localStorage<"u")console.log("[PartnerStack] Checking localStorage for ps_xid"),B=localStorage.getItem("ps_xid"),console.log("[PartnerStack] localStorage ps_xid:",B);else console.log("[PartnerStack] localStorage not available")}catch(M){console.warn("[PartnerStack] localStorage access error:",M),B=null}if(!B)console.log("[PartnerStack] Falling back to cookie"),B=s("ps_xid");return console.log("[PartnerStack] Final PartnerStack ID:",B),B}function _(){console.log("[PartnerStack] injectPartnerStackId called");let B=m();if(!B){console.log("[PartnerStack] No PartnerStack ID available, skipping injection");return}console.log("[PartnerStack] Injecting PartnerStack ID:",B);let M=['input[name="partnerstack_click_id"]','input[name$="/partnerstack_click_id"]','input[name="ps_xid"]','input[name$="/ps_xid"]'];console.log("[PartnerStack] Searching for fields with selectors:",M);let w=document.querySelectorAll(M.join(", "));console.log("[PartnerStack] Found",w.length,"potential input fields"),w.forEach(function(L,b){if(console.log("[PartnerStack] Processing field",b+1,"- name:",L.name,"current value:",L.value),L&&!L.value)try{console.log("[PartnerStack] Injecting into field:",L.name),L.value=B,L.setAttribute("value",B);let z=new Event("input",{bubbles:!0}),U=new Event("change",{bubbles:!0});L.dispatchEvent(z),L.dispatchEvent(U),console.log("[PartnerStack] Successfully injected ID into field:",L.name)}catch(z){console.warn("[PartnerStack] Failed to inject into field:",L.name,z)}else console.log("[PartnerStack] Skipping field:",L.name,"- reason:",L.value?"already has value":"invalid element")})}function d(){if(console.log("[PartnerStack] setupHubSpotListener called"),!window.hbspt||!window.hbspt.forms){console.log("[PartnerStack] HubSpot forms library not available, skipping listener setup");return}console.log("[PartnerStack] HubSpot forms library detected, setting up message listener"),window.addEventListener("message",function(B){console.log("[PartnerStack] Received message event:",B.data);try{if(B.data&&B.data.type==="hsFormCallback"){let w=B.data.eventName;if(console.log("[PartnerStack] HubSpot form callback received:",w),w==="onFormReady")console.log("[PartnerStack] Form ready event detected, scheduling injection in 100ms"),setTimeout(_,100)}else console.log("[PartnerStack] Ignoring non-HubSpot message:",B.data?B.data.type:"no type")}catch(M){console.warn("[PartnerStack] Error processing message event:",M)}})}function K(){console.log("[PartnerStack] Initializing PartnerStack cookie helper"),console.log("[PartnerStack] Current document readyState:",document.readyState),console.log("[PartnerStack] Attempting immediate injection"),_(),console.log("[PartnerStack] Setting up HubSpot listeners"),d(),console.log("[PartnerStack] Scheduling delayed injections at 1s and 3s"),setTimeout(function(){console.log("[PartnerStack] Running 1-second delayed injection"),_()},1000),setTimeout(function(){console.log("[PartnerStack] Running 3-second delayed injection"),_()},3000)}console.log("[PartnerStack] Checking DOM readyState for initialization:",document.readyState);if(document.readyState==="loading")console.log("[PartnerStack] DOM still loading, waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",function(){console.log("[PartnerStack] DOMContentLoaded fired, starting initialization"),K()});else console.log("[PartnerStack] DOM already loaded, starting initialization immediately"),K();var E={get router(){return window.HubSpotRouter||{}},get cookieHelper(){return{getPartnerStackId:typeof window.getPartnerStackId==="function"?window.getPartnerStackId:null,injectPartnerStackId:typeof window.injectPartnerStackId==="function"?window.injectPartnerStackId:null}},initialized:!0,version:"1.0.0"};window.HubSpotFormsComplete=E;var o=E;export{o as default};
