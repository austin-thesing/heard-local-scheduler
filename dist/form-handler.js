(function(){let x={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},z={success:"/thank-you/success",schedule:"/thank-you/schedule"},O=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],X=["yes","true","y","1","multiple owners","multi"],A=["no","false","n","0"];function L(J){if(J==null)return"";return String(J).trim().toLowerCase()}function F(J){let W=L(J);if(!W)return!1;if(X.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function p(J){let W=L(J);if(!W)return!1;if(A.includes(W))return!0;return W.startsWith("no")}function N(J,W){if(!J)return null;for(let $ of W){if(J[$])return J[$];let q=[`0-1/${$}`,`0-2/${$}`,`0-3/${$}`];for(let Z of q)if(J[Z])return J[Z]}return null}let V=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function j(...J){if(V)console.log("[HubSpot Router]",...J)}let U="partnerstack_click_id",S=[U,"ps_xid","psx_id"],k=["ps_xid","psx_id"];function I(J){try{if(!document.cookie)return null;let W=document.cookie.split(";");for(let $ of W){let q=$.trim();if(!q)continue;if(q.startsWith(`${J}=`)){let[,Z]=q.split("=");if(Z)return decodeURIComponent(Z)}}}catch(W){j(`cookie access error for ${J}:`,W)}return null}function g(){let J=[];for(let q of k){let Z=I(q);if(Z)j("Found PartnerStack ID in cookie",q+":",Z),J.push(Z)}try{if(window.partnerstack&&window.partnerstack.ps_xid)j("Found PartnerStack ID in window.partnerstack:",window.partnerstack.ps_xid),J.push(window.partnerstack.ps_xid)}catch(q){j("Partnerstack global lookup error:",q)}try{if(window.ps_xid)j("Found PartnerStack ID in window.ps_xid:",window.ps_xid),J.push(window.ps_xid)}catch(q){j("ps_xid global lookup error:",q)}try{S.forEach((q)=>{let Z=localStorage.getItem(q);if(Z)j("Found PartnerStack ID in localStorage",q+":",Z),J.push(Z)})}catch(q){j("localStorage access error for partnerstack id:",q)}try{S.forEach((q)=>{let Z=sessionStorage.getItem(q);if(Z)j("Found PartnerStack ID in sessionStorage",q+":",Z),J.push(Z)})}catch(q){j("sessionStorage access error for partnerstack id:",q)}let W=I(U);if(W&&!J.includes(W))j("Found PartnerStack ID in partnerstack_click_id cookie:",W),J.push(W);j("All PartnerStack ID candidates:",J);let $=J.find((q)=>q&&q!=="undefined"&&q!=="null");return j("Resolved PartnerStack ID:",$),$||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=V;let K=!1;function b(J){try{if(!J)return"";let W=String(J);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return J}}function y(J){let W={};if(!J)return W;if(Array.isArray(J))return J.forEach(($)=>{if(!$)return;let q=$.name||$.field||"",Z=b(q),B=typeof $.value==="string"?$.value:Array.isArray($.value)?$.value[0]:$.value!=null?String($.value):"";if(q)W[q]=B;if(Z&&Z!==q)W[Z]=B}),W;if(J.fields){let $=J.fields;if(Array.isArray($))$.forEach((q)=>{if(!q)return;let Z=q.name||q.field||"",B=b(Z),Q=typeof q.value==="string"?q.value:Array.isArray(q.value)?q.value[0]:q.value!=null?String(q.value):"";if(Z)W[Z]=Q;if(B&&B!==Z)W[B]=Q});else if(typeof $==="object")Object.entries($).forEach(([q,Z])=>{let B=b(q),Q=typeof Z==="string"?Z:Array.isArray(Z)?Z[0]:Z!=null?String(Z):"";if(W[q]=Q,B&&B!==q)W[B]=Q});return W}return Object.entries(J).forEach(([$,q])=>{let Z=b($),B=typeof q==="string"?q:Array.isArray(q)?q[0]:q!=null?String(q):"";if(W[$]=B,Z&&Z!==$)W[Z]=B}),W}function C(J){let W=N(J,O),$=W&&F(W);if(!$)return j("Multi-practice question not answered yes, routing to success page",{field:O.find((q)=>J[q]),value:W,hasYes:$}),"success";return j("Multi-practice question answered yes, routing to scheduler",{multiPracticeValue:W}),"general"}function h(J,W){let $=x[J]||x.general,q=new URL($.url);return q.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([Q,Y])=>{for(let H of Y)if(W[H]){q.searchParams.set(Q,W[H]),j(`Mapping ${H} -> ${Q}: ${W[H]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((Q)=>{if(W[Q])q.searchParams.set(Q,W[Q])}),j("Built scheduler URL:",q.toString()),q.toString()}function v(J,W){if(W==="success"){let B=new URLSearchParams;if(J.email)B.set("email",J.email);let Q=`${z.success}${B.toString()?"?"+B.toString():""}`;j("Redirecting to success page for soft rejection:",Q);try{window.location.replace(Q)}catch(Y){j("replace() failed, using href for success redirect",Y),window.location.href=Q}return}let $={scheduler_type:W,formData:J,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify($)),j("Stored router data in sessionStorage")}catch(B){j("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(J))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(J)),j("Stored form data in localStorage for prefill")}catch(B){j("Failed to store form data in localStorage:",B)}let q=new URLSearchParams;if(J.email)q.set("email",J.email);let Z=`${z.schedule}${q.toString()?"?"+q.toString():""}`;j("Redirecting to:",Z);try{window.location.replace(Z)}catch(B){j("replace() failed, using href for scheduler redirect",B),window.location.href=Z}}function P(J,W={}){if(j("Form submission detected:",J),K){j("Routing already performed; skipping");return}K=!0;let $=g();if($){J.partnerstack_click_id=$,J["0-1/partnerstack_click_id"]=$,J["0-2/partnerstack_click_id"]=$,J["0-3/partnerstack_click_id"]=$,j("Injected PartnerStack ID into submission:",$);try{sessionStorage.setItem(U,$)}catch(Z){j("Failed to persist partnerstack id in sessionStorage:",Z)}try{localStorage.setItem(U,$)}catch(Z){j("Failed to persist partnerstack id in localStorage:",Z)}}let q=C(J);if(v(J,q),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:q,has_email:!!J.email,has_name:!!(J.firstname||J.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:q,method:"redirect"})}function D(){window._capturedFormData=window._capturedFormData||{};let J={},W=new WeakSet;function $(Z,B="change"){if(!Z.name)return;let Q=Z.name,Y=b(Q),H=Z.value,G=H;if(Z.type==="radio"){let w=Z.closest("label");if(w&&w.textContent){let M=w.textContent.replace(/\s+/g," ").trim();if(M)G=M}}if(J[Q]===G)return;if(J[Q]=G,Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(window._capturedFormData[Q]=G,Y&&Y!==Q)window._capturedFormData[Y]=G;if(Z.type==="radio"){if(window._capturedFormData[`${Q}_raw`]=H,Y&&Y!==Q)window._capturedFormData[`${Y}_raw`]=H;let w=document.querySelector(`input[type="hidden"][name="${Q}"]`);if(w&&w.value){if(window._capturedFormData[Q]=w.value,Y&&Y!==Q)window._capturedFormData[Y]=w.value;G=w.value}}if(G){let w=Z.type||Z.tagName.toLowerCase();if(Z.type==="tel"||Q.toLowerCase().includes("phone")){let M=G.replace(/[\s\-\(\)\.]/g,"");if(M)window._capturedFormData[Q+"_clean"]=M;j("Captured phone:",Q,"=",G)}else if(Z.type==="radio")j("Captured radio selection:",Q,"=",G,"(raw:",H,")");else if(Z.type==="hidden"){if(Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(Z.closest(".hsfc-DropdownField"))j("Captured dropdown:",Q,"=",G);else j("Captured field:",Q,"=",G)}else j("Captured",w+":",Q,"=",G)}}function q(){let Z=new MutationObserver((Q)=>{let Y=[];if(Q.forEach((H)=>{H.addedNodes.forEach((G)=>{if(G.nodeType===1)Y.push(G)})}),Y.length===0)return;Y.forEach((H)=>{let G=H.querySelectorAll?H.querySelectorAll("input[name], select[name], textarea[name]"):[];if(H.tagName&&(H.tagName==="INPUT"||H.tagName==="SELECT"||H.tagName==="TEXTAREA")&&H.name)B(H);G.forEach((w)=>B(w))})});function B(Q){if(W.has(Q))return;if(W.add(Q),Q.readOnly&&Q.type!=="hidden")return;if(Q.type==="hidden"&&Q.name){let Y=Q.value,H=setInterval(()=>{if(Q.value!==Y)Y=Q.value,$(Q,"programmatic");if(!document.body.contains(Q))clearInterval(H)},500);if(Q.value)$(Q,"initial")}else if(Q.type==="radio")Q.addEventListener("change",()=>$(Q));else if(Q.type==="tel"||Q.name&&Q.name.toLowerCase().includes("phone"))Q.addEventListener("blur",()=>$(Q)),Q.addEventListener("change",()=>$(Q));else if(Q.addEventListener("change",()=>$(Q)),Q.addEventListener("blur",()=>$(Q)),Q.value)$(Q,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(B),Z.observe(document.body,{childList:!0,subtree:!0}),j("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",q);else q()}function c(J){if(!J)return!1;let W=!!N(J,O);return Boolean(J.email||J.firstname||J.first_name||J.lastname||J.last_name||J.company||J.practice_name)||W}function f(J={}){j("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function(Q){try{let Y=new URL(Q).hostname;return Y.endsWith("hubspot.com")||Y.endsWith("hsforms.com")||Y.endsWith("hsforms.net")||Y.endsWith("hsappstatic.net")||Y.includes("hubspot")||Y.includes("hsforms")}catch(Y){return!1}}(W.origin))return;let q=W.data;if(typeof q==="string")try{q=JSON.parse(q)}catch(Q){}j("Received message from HubSpot:",q);let Z=q&&(q.type||q.messageType),B=q&&q.eventName;if(q&&Z==="hsFormCallback"&&(B==="onFormSubmitted"||B==="onFormSubmit")){let Q=q&&q.data?y(q.data):{},Y=window._capturedFormData&&typeof window._capturedFormData==="object"?window._capturedFormData:{},H={...Q,...Y};if(!c(H)){if(B==="onFormSubmit")j("onFormSubmit received without routing fields; waiting for onFormSubmitted event");else j("Submission payload lacks routing data; skipping redirect");return}try{window._capturedFormData={...H}}catch(w){j("Failed to persist merged submission data globally:",w)}let G={...J,formGuid:q.data?.formGuid||q.formGuid,portalId:q.data?.portalId||q.portalId};P(H,G)}else if(q&&q.formGuid&&q.accepted===!0){if(j("Developer embed submission detected"),j("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),j("Stored captured form data in localStorage for prefill")}catch(Y){j("Failed to store captured form data in localStorage:",Y)}let Q={...J,formGuid:q.formGuid,portalId:q.portalId};P(window._capturedFormData,Q)}}else if(q&&Z==="hsFormCallback"&&V)j("Ignoring hsFormCallback event:",B)}),j("PostMessage listener initialized")}function R(J={}){let $={...{redirect:!0,debug:V},...J};if($.debug)window.HubSpotRouterDebug={config:x,determineSchedulerType:C,buildSchedulerUrl:h,handleFormSubmission:P},j("Debug mode enabled. Access via window.HubSpotRouterDebug");D(),f($),j("HubSpot Form Router initialized with config:",$)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>R());else R();window.HubSpotRouter={...window.HubSpotRouter,init:R,handleFormSubmission:P,determineSchedulerType:C,buildSchedulerUrl:h,config:x,DEBUG:V},j("HubSpot Form Router loaded")})();function s(x){if(console.log("[PartnerStack] getCookie called with name:",x),!x||typeof x!=="string")return console.log("[PartnerStack] getCookie: invalid name parameter"),null;try{let z=new RegExp("(?:^|; )"+x.replace(/([.$?*|{}()[\]\\/+^])/g,"\\$1")+"=([^;]*)"),O=document.cookie.match(z),X=O?decodeURIComponent(O[1]):null;return console.log("[PartnerStack] getCookie result for",x+":",X),X}catch(z){return console.warn("[PartnerStack] getCookie error:",z),null}}function m(){console.log("[PartnerStack] getPartnerStackId called");var x=null;try{if(typeof sessionStorage<"u")console.log("[PartnerStack] Checking sessionStorage for ps_xid"),x=sessionStorage.getItem("ps_xid"),console.log("[PartnerStack] sessionStorage ps_xid:",x);else console.log("[PartnerStack] sessionStorage not available")}catch(z){console.warn("[PartnerStack] sessionStorage access error:",z),x=null}if(!x)console.log("[PartnerStack] Falling back to cookie"),x=s("ps_xid");return console.log("[PartnerStack] Final PartnerStack ID:",x),x}function _(){console.log("[PartnerStack] injectPartnerStackId called");let x=m();if(!x){console.log("[PartnerStack] No PartnerStack ID available, skipping injection");return}console.log("[PartnerStack] Injecting PartnerStack ID:",x);let z=['input[name="partnerstack_click_id"]','input[name$="/partnerstack_click_id"]','input[name="ps_xid"]','input[name$="/ps_xid"]'];console.log("[PartnerStack] Searching for fields with selectors:",z);let O=document.querySelectorAll(z.join(", "));console.log("[PartnerStack] Found",O.length,"potential input fields"),O.forEach(function(X,A){if(console.log("[PartnerStack] Processing field",A+1,"- name:",X.name,"current value:",X.value),X&&!X.value)try{console.log("[PartnerStack] Injecting into field:",X.name),X.value=x,X.setAttribute("value",x);let L=new Event("input",{bubbles:!0}),F=new Event("change",{bubbles:!0});X.dispatchEvent(L),X.dispatchEvent(F),console.log("[PartnerStack] Successfully injected ID into field:",X.name)}catch(L){console.warn("[PartnerStack] Failed to inject into field:",X.name,L)}else console.log("[PartnerStack] Skipping field:",X.name,"- reason:",X.value?"already has value":"invalid element")})}function d(){if(console.log("[PartnerStack] setupHubSpotListener called"),!window.hbspt||!window.hbspt.forms){console.log("[PartnerStack] HubSpot forms library not available, skipping listener setup");return}console.log("[PartnerStack] HubSpot forms library detected, setting up message listener"),window.addEventListener("message",function(x){console.log("[PartnerStack] Received message event:",x.data);try{if(x.data&&x.data.type==="hsFormCallback"){let O=x.data.eventName;if(console.log("[PartnerStack] HubSpot form callback received:",O),O==="onFormReady")console.log("[PartnerStack] Form ready event detected, scheduling injection in 100ms"),setTimeout(_,100)}else console.log("[PartnerStack] Ignoring non-HubSpot message:",x.data?x.data.type:"no type")}catch(z){console.warn("[PartnerStack] Error processing message event:",z)}})}function T(){console.log("[PartnerStack] Initializing PartnerStack cookie helper"),console.log("[PartnerStack] Current document readyState:",document.readyState),console.log("[PartnerStack] Attempting immediate injection"),_(),console.log("[PartnerStack] Setting up HubSpot listeners"),d(),console.log("[PartnerStack] Scheduling delayed injections at 1s and 3s"),setTimeout(function(){console.log("[PartnerStack] Running 1-second delayed injection"),_()},1000),setTimeout(function(){console.log("[PartnerStack] Running 3-second delayed injection"),_()},3000)}console.log("[PartnerStack] Checking DOM readyState for initialization:",document.readyState);if(document.readyState==="loading")console.log("[PartnerStack] DOM still loading, waiting for DOMContentLoaded"),document.addEventListener("DOMContentLoaded",function(){console.log("[PartnerStack] DOMContentLoaded fired, starting initialization"),T()});else console.log("[PartnerStack] DOM already loaded, starting initialization immediately"),T();var E={get router(){return window.HubSpotRouter||{}},get cookieHelper(){return{getPartnerStackId:typeof window.getPartnerStackId==="function"?window.getPartnerStackId:null,injectPartnerStackId:typeof window.injectPartnerStackId==="function"?window.injectPartnerStackId:null}},initialized:!0,version:"1.0.0"};window.HubSpotFormsComplete=E;var o=E;export{o as default};
