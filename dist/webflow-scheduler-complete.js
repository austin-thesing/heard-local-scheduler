(function(){let M=window.location.search.includes("debug=true");function z(...j){if(M)console.log("[Webflow Scheduler]",...j)}let R={sole_prop:{url:"https://meetings.hubspot.com/bz/consultation",name:"Round Robin Consultation",description:"For all practices (round-robin)"}};function V(){try{let j=localStorage.getItem("hubspot_form_data");if(j){let J=JSON.parse(j);return z("Found form data in localStorage:",J),{formData:J,source:"localStorage"}}}catch(j){z("localStorage error:",j)}try{let j=sessionStorage.getItem("scheduler_router_data");if(j){let J=JSON.parse(j);return z("Found router data in sessionStorage:",J),sessionStorage.removeItem("scheduler_router_data"),{formData:J.formData,schedulerType:J.scheduler_type,source:"sessionStorage"}}}catch(j){z("sessionStorage error:",j)}try{let j=(Z)=>{let $=`; ${document.cookie}`.split(`; ${Z}=`);if($.length===2)return $.pop().split(";").shift()},J=j("scheduler_type"),q=j("form_data");if(J||q){let Z=q?JSON.parse(atob(q)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",z("Found data in cookies:",{schedulerType:J,formData:Z}),{formData:Z,schedulerType:J,source:"cookies"}}}catch(j){z("cookie error:",j)}return null}function _(){let j={},J=new URLSearchParams(window.location.search);for(let[q,Z]of J)j[q]=Z;return j}function v(j){let J=R.sole_prop,q=new URL(J.url);return q.searchParams.set("embed","true"),Object.entries({email:["email","email_address","0-1/email","0-2/email"],firstname:["firstname","first_name","fname","0-1/firstname","0-2/firstname"],lastname:["lastname","last_name","lname","0-1/lastname","0-2/lastname"],company:["company","practice_name","business_name","0-1/company","0-2/company"],phone:["phone","phone_number","telephone","0-1/phone","0-2/phone"]}).forEach(([K,W])=>{for(let Y of W)if(j[Y]){q.searchParams.set(K,j[Y]),z(`Mapping ${Y} -> ${K}: ${j[Y]}`);break}}),["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","what_best_describes_your_practice_","referrer","submissionGuid","uuid"].forEach((K)=>{if(j[K])q.searchParams.set(K,j[K]),z(`Adding additional field: ${K} = ${j[K]}`);else{let W=[`0-1/${K}`,`0-2/${K}`];for(let Y of W)if(j[Y]){q.searchParams.set(K,j[Y]),z(`Adding prefixed field: ${Y} -> ${K} = ${j[Y]}`);break}}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((K)=>{if(j[K])q.searchParams.set(K,j[K])}),z("Built scheduler URL:",q.toString()),q.toString()}function B(){try{if(typeof fbq<"u")fbq("track","Lead",{content_category:"consultation",content_name:"round_robin_consultation"});if(typeof rdt<"u")rdt("track","Lead",{customEventName:"ConsultationScheduler",schedulerType:"round_robin"});if(typeof gtag<"u")gtag("event","generate_lead",{event_category:"engagement",event_label:"round_robin_consultation"});else if(typeof ga<"u")ga("send","event","Lead","Generate","round_robin_consultation");if(typeof window.posthog<"u")window.posthog.capture("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});if(typeof window.amplitude<"u")window.amplitude.track("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});z("Lead events fired")}catch(j){z("Lead tracking error:",j)}}function H(){z("Starting scheduler setup...");let j=_(),J=V(),q={...j};if(J&&J.formData)q={...q,...J.formData},z("Merged form data from storage:",q);if(!(q.email||q.firstname||q.first_name||q["0-1/email"]||q["0-1/firstname"]||q["0-2/email"]||q["0-2/firstname"]||Object.keys(q).some((W)=>W!=="debug"&&W!=="utm_source"&&W!=="utm_medium"&&W!=="utm_campaign"&&!W.startsWith("group[")&&q[W]))){z("No form data found, redirecting to /free-consult"),window.location.href="/free-consult";return}z("Form data found, setting up scheduler");let X=document.getElementById("scheduler-target");if(!X){let W=document.querySelector('iframe[src*="meetings.hubspot.com"]'),Y=document.querySelector(".meetings-iframe-container");if(W||Y){z("Found existing iframe/container, will enhance it");let A=document.createElement("div");if(A.id="scheduler-target",Y)Y.parentNode.insertBefore(A,Y),A.appendChild(Y);else if(W)W.parentNode.insertBefore(A,W),A.appendChild(W);X=A}}if(!X)z("No target found, creating scheduler-target div"),X=document.createElement("div"),X.id="scheduler-target",X.style.cssText="min-height: 600px; width: 100%;",document.body.appendChild(X);let $=v(q);z("Injecting scheduler into target"),z("Final URL:",$),X.innerHTML=`<div class="meetings-iframe-container" data-src="${$}"></div>`;let K=document.createElement("script");return K.src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js",K.onload=function(){z("HubSpot embed script loaded successfully"),B()},K.onerror=function(){console.error("[Webflow Scheduler] Failed to load HubSpot embed script")},document.head.appendChild(K),!0}function T(){if(!M)return;let j=document.createElement("div");j.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      border: 2px solid #226752;
    `;let J=V(),q=new URLSearchParams(window.location.search);j.innerHTML=`
      <strong>\uD83D\uDD27 Webflow Scheduler Debug</strong><br><br>
      <strong>Form Data Sources:</strong><br>
      \uD83D\uDCC1 localStorage: ${localStorage.getItem("hubspot_form_data")?"✅ Found":"❌ Empty"}<br>
      \uD83D\uDCBE sessionStorage: ${sessionStorage.getItem("scheduler_router_data")?"✅ Found":"❌ Empty"}<br>
      \uD83C\uDF6A Cookies: ${document.cookie.includes("form_data=")?"✅ Found":"❌ Empty"}<br><br>
      <strong>URL Parameters:</strong><br>
      ${q.toString()||"None"}<br><br>
      <strong>Stored Data:</strong><br>
      ${J?`Source: ${J.source}<br>Fields: ${Object.keys(J.formData||{}).join(", ")}`:"None found"}<br><br>
      <strong>Action:</strong><br>
      ${J||q.toString()?"✅ Loading scheduler":"❌ Will redirect to /free-consult"}
    `,document.body.appendChild(j);let Z=!1,X={x:0,y:0};j.addEventListener("mousedown",($)=>{Z=!0,X.x=$.clientX-j.offsetLeft,X.y=$.clientY-j.offsetTop}),document.addEventListener("mousemove",($)=>{if(Z)j.style.left=$.clientX-X.x+"px",j.style.top=$.clientY-X.y+"px",j.style.right="auto"}),document.addEventListener("mouseup",()=>{Z=!1})}function Q(){z("Webflow Scheduler Complete initializing..."),T(),H(),z("Webflow Scheduler Complete initialized")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Q);else Q();if(M)window.WebflowSchedulerComplete={getStoredFormData:V,getQueryParams:_,buildSchedulerUrl:v,handleScheduler:H,fireLeadEvents:B,init:Q,config:R};z("Webflow Scheduler Complete script loaded")})();
