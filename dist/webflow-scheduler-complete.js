(function(){let A=window.location.search.includes("debug=true");function z(...j){if(A)console.log("[Webflow Scheduler]",...j)}let R={sole_prop:{url:"https://meetings.hubspot.com/bz/consultation",name:"Round Robin Consultation",description:"For all practices (round-robin)"}};function M(){try{let j=localStorage.getItem("hubspot_form_data");if(j){let J=JSON.parse(j);return z("Found form data in localStorage:",J),{formData:J,source:"localStorage"}}}catch(j){z("localStorage error:",j)}try{let j=sessionStorage.getItem("scheduler_router_data");if(j){let J=JSON.parse(j);return z("Found router data in sessionStorage:",J),sessionStorage.removeItem("scheduler_router_data"),{formData:J.formData,schedulerType:J.scheduler_type,source:"sessionStorage"}}}catch(j){z("sessionStorage error:",j)}try{let j=(X)=>{let Y=`; ${document.cookie}`.split(`; ${X}=`);if(Y.length===2)return Y.pop().split(";").shift()},J=j("scheduler_type"),q=j("form_data");if(J||q){let X=q?JSON.parse(atob(q)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",z("Found data in cookies:",{schedulerType:J,formData:X}),{formData:X,schedulerType:J,source:"cookies"}}}catch(j){z("cookie error:",j)}return null}function _(){let j={},J=new URLSearchParams(window.location.search);for(let[q,X]of J)j[q]=X;return j}function v(j){let J=R.sole_prop,q=new URL(J.url);return q.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([K,W])=>{for(let Z of W)if(j[Z]){q.searchParams.set(K,j[Z]),z(`Mapping ${Z} -> ${K}: ${j[Z]}`);break}}),["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","what_best_describes_your_practice_","referrer","submissionGuid","uuid"].forEach((K)=>{if(j[K])q.searchParams.set(K,j[K]),z(`Adding additional field: ${K} = ${j[K]}`)}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((K)=>{if(j[K])q.searchParams.set(K,j[K])}),z("Built scheduler URL:",q.toString()),q.toString()}function B(){try{if(typeof fbq!=="undefined")fbq("track","Lead",{content_category:"consultation",content_name:"round_robin_consultation"});if(typeof rdt!=="undefined")rdt("track","Lead",{customEventName:"ConsultationScheduler",schedulerType:"round_robin"});if(typeof gtag!=="undefined")gtag("event","generate_lead",{event_category:"engagement",event_label:"round_robin_consultation"});else if(typeof ga!=="undefined")ga("send","event","Lead","Generate","round_robin_consultation");if(typeof window.posthog!=="undefined")window.posthog.capture("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});if(typeof window.amplitude!=="undefined")window.amplitude.track("scheduler_lead_generated",{scheduler_type:"round_robin",source:"webflow_complete"});z("Lead events fired")}catch(j){z("Lead tracking error:",j)}}function H(){z("Starting scheduler setup...");let j=_(),J=M(),q={...j};if(J&&J.formData)q={...q,...J.formData},z("Merged form data from storage:",q);if(!(q.email||q.firstname||q.first_name||Object.keys(q).some((W)=>W!=="debug"&&W!=="utm_source"&&W!=="utm_medium"&&W!=="utm_campaign"&&q[W]))){z("No form data found, redirecting to /free-consult"),window.location.href="/free-consult";return}z("Form data found, setting up scheduler");let V=document.getElementById("scheduler-target");if(!V){let W=document.querySelector('iframe[src*="meetings.hubspot.com"]'),Z=document.querySelector(".meetings-iframe-container");if(W||Z){z("Found existing iframe/container, will enhance it");let $=document.createElement("div");if($.id="scheduler-target",Z)Z.parentNode.insertBefore($,Z),$.appendChild(Z);else if(W)W.parentNode.insertBefore($,W),$.appendChild(W);V=$}}if(!V)z("No target found, creating scheduler-target div"),V=document.createElement("div"),V.id="scheduler-target",V.style.cssText="min-height: 600px; width: 100%;",document.body.appendChild(V);let Y=v(q);z("Injecting scheduler into target"),z("Final URL:",Y),V.innerHTML=`<div class="meetings-iframe-container" data-src="${Y}"></div>`;let K=document.createElement("script");return K.src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js",K.onload=function(){z("HubSpot embed script loaded successfully"),B()},K.onerror=function(){console.error("[Webflow Scheduler] Failed to load HubSpot embed script")},document.head.appendChild(K),!0}function T(){if(!A)return;let j=document.createElement("div");j.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      border: 2px solid #226752;
    `;let J=M(),q=new URLSearchParams(window.location.search);j.innerHTML=`
      <strong>\uD83D\uDD27 Webflow Scheduler Debug</strong><br><br>
      <strong>Form Data Sources:</strong><br>
      \uD83D\uDCC1 localStorage: ${localStorage.getItem("hubspot_form_data")?"✅ Found":"❌ Empty"}<br>
      \uD83D\uDCBE sessionStorage: ${sessionStorage.getItem("scheduler_router_data")?"✅ Found":"❌ Empty"}<br>
      \uD83C\uDF6A Cookies: ${document.cookie.includes("form_data=")?"✅ Found":"❌ Empty"}<br><br>
      <strong>URL Parameters:</strong><br>
      ${q.toString()||"None"}<br><br>
      <strong>Stored Data:</strong><br>
      ${J?`Source: ${J.source}<br>Fields: ${Object.keys(J.formData||{}).join(", ")}`:"None found"}<br><br>
      <strong>Action:</strong><br>
      ${J||q.toString()?"✅ Loading scheduler":"❌ Will redirect to /free-consult"}
    `,document.body.appendChild(j);let X=!1,V={x:0,y:0};j.addEventListener("mousedown",(Y)=>{X=!0,V.x=Y.clientX-j.offsetLeft,V.y=Y.clientY-j.offsetTop}),document.addEventListener("mousemove",(Y)=>{if(X)j.style.left=Y.clientX-V.x+"px",j.style.top=Y.clientY-V.y+"px",j.style.right="auto"}),document.addEventListener("mouseup",()=>{X=!1})}function Q(){z("Webflow Scheduler Complete initializing..."),T(),H(),z("Webflow Scheduler Complete initialized")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Q);else Q();if(A)window.WebflowSchedulerComplete={getStoredFormData:M,getQueryParams:_,buildSchedulerUrl:v,handleScheduler:H,fireLeadEvents:B,init:Q,config:R};z("Webflow Scheduler Complete script loaded")})();
