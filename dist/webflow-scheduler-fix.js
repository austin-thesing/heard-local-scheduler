(function(){let $=window.location.search.includes("debug=true");function z(...j){if($)console.log("[Webflow Scheduler Fix]",...j)}let v={sole_prop:{url:"https://meetings.hubspot.com/bz/consultation",name:"Round Robin Consultation",description:"For all practices (round-robin)"},s_corp:{url:"https://meetings.hubspot.com/bz/consultations",name:"S-Corp Consultation",description:"For multi-owner practices"}};function w(){try{let j=localStorage.getItem("hubspot_form_data");if(j){let K=JSON.parse(j);return z("Found form data in localStorage:",K),{formData:K,source:"localStorage"}}}catch(j){z("localStorage error:",j)}try{let j=sessionStorage.getItem("scheduler_router_data");if(j){let K=JSON.parse(j);return z("Found router data in sessionStorage:",K),sessionStorage.removeItem("scheduler_router_data"),{formData:K.formData,schedulerType:K.scheduler_type,source:"sessionStorage"}}}catch(j){z("sessionStorage error:",j)}try{let j=(q)=>{let X=`; ${document.cookie}`.split(`; ${q}=`);if(X.length===2)return X.pop().split(";").shift()},K=j("scheduler_type"),J=j("form_data");if(K||J){let q=J?JSON.parse(atob(J)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",z("Found data in cookies:",{schedulerType:K,formData:q}),{formData:q,schedulerType:K,source:"cookies"}}}catch(j){z("cookie error:",j)}return null}function W(j,K="sole_prop"){let J=v[K]||v.sole_prop,q=new URL(J.url);q.searchParams.set("embed","true");let Q={email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]},X=["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","what_best_describes_your_practice_","referrer","submissionGuid","uuid"];return Object.entries(Q).forEach(([V,L])=>{for(let Z of L)if(j[Z]){q.searchParams.set(V,j[Z]),z(`Mapping ${Z} -> ${V}: ${j[Z]}`);break}}),X.forEach((V)=>{if(j[V])q.searchParams.set(V,j[V]),z(`Adding additional field: ${V} = ${j[V]}`)}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((V)=>{if(j[V])q.searchParams.set(V,j[V])}),z("Built enhanced scheduler URL:",q.toString()),q.toString()}function B(){document.querySelectorAll('iframe[src*="meetings.hubspot.com"]').forEach((J)=>{try{let q=new URL(J.src);if(!q.searchParams.has("embed"))z("Found iframe without embed=true, fixing:",J.src),q.searchParams.set("embed","true"),J.src=q.toString(),z("Fixed iframe URL:",J.src)}catch(q){z("Error fixing iframe URL:",q)}}),document.querySelectorAll('.meetings-iframe-container[data-src*="meetings.hubspot.com"]').forEach((J)=>{try{let q=J.getAttribute("data-src"),Q=new URL(q);if(!Q.searchParams.has("embed"))z("Found container without embed=true, fixing:",q),Q.searchParams.set("embed","true"),J.setAttribute("data-src",Q.toString()),z("Fixed container data-src:",Q.toString())}catch(q){z("Error fixing container URL:",q)}})}function Y(){z("Looking for existing HubSpot iframe...");let j=document.querySelector(".meetings-iframe-container"),K=document.querySelector('iframe[src*="meetings.hubspot.com"]')||document.querySelector('iframe[src*="hsforms.com"]');if(!j&&!K)return z("No HubSpot iframe found"),!1;let J=w();if(!J||!J.formData)return z("No stored form data found, leaving iframe as-is"),!1;z("Found stored form data, enhancing iframe...");let q=W(J.formData,"sole_prop");if(j){z("Updating iframe container"),j.setAttribute("data-src",q);let Q=j.querySelector("iframe");if(Q)Q.src=q,z("Updated existing iframe src")}else if(K)z("Updating iframe directly"),K.src=q;B();try{if(typeof window.posthog!=="undefined")window.posthog.capture("scheduler_enhanced_on_webflow",{source:J.source,has_email:!!J.formData.email,has_name:!!(J.formData.firstname||J.formData.first_name)});if(typeof window.amplitude!=="undefined")window.amplitude.track("scheduler_enhanced_on_webflow",{source:J.source,has_email:!!J.formData.email})}catch(Q){z("Analytics error:",Q)}return z("Iframe enhancement completed"),!0}function H(){if(!$)return;let j=document.createElement("div");j.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      border: 2px solid #226752;
    `;let K=w(),J=new URLSearchParams(window.location.search);j.innerHTML=`
      <strong>\uD83D\uDD27 Webflow Scheduler Debug</strong><br><br>
      <strong>Form Data Sources:</strong><br>
      \uD83D\uDCC1 localStorage: ${localStorage.getItem("hubspot_form_data")?"✅ Found":"❌ Empty"}<br>
      \uD83D\uDCBE sessionStorage: ${sessionStorage.getItem("scheduler_router_data")?"✅ Found":"❌ Empty"}<br>
      \uD83C\uDF6A Cookies: ${document.cookie.includes("form_data=")?"✅ Found":"❌ Empty"}<br><br>
      <strong>URL Parameters:</strong><br>
      ${J.toString()||"None"}<br><br>
      <strong>Stored Data:</strong><br>
      ${K?`Source: ${K.source}<br>Fields: ${Object.keys(K.formData||{}).join(", ")}`:"None found"}
    `,document.body.appendChild(j);let q=!1,Q={x:0,y:0};j.addEventListener("mousedown",(X)=>{q=!0,Q.x=X.clientX-j.offsetLeft,Q.y=X.clientY-j.offsetTop}),document.addEventListener("mousemove",(X)=>{if(q)j.style.left=X.clientX-Q.x+"px",j.style.top=X.clientY-Q.y+"px",j.style.right="auto"}),document.addEventListener("mouseup",()=>{q=!1})}function A(){if(z("Webflow Scheduler Fix initializing..."),H(),setTimeout(()=>{z("Ensuring all HubSpot iframes have embed=true parameter..."),B()},500),Y()){z("Successfully enhanced existing iframe");return}setTimeout(()=>{z("Retrying iframe enhancement after delay..."),Y()},2000),new MutationObserver((K)=>{K.forEach((J)=>{J.addedNodes.forEach((q)=>{if(q.nodeType===1){if(q.querySelector&&q.querySelector('iframe[src*="meetings.hubspot.com"]')||q.tagName==="IFRAME"&&q.src&&q.src.includes("meetings.hubspot.com"))z("New HubSpot iframe detected, enhancing..."),setTimeout(()=>Y(),100)}})})}).observe(document.body,{childList:!0,subtree:!0}),z("Webflow Scheduler Fix initialized")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",A);else A();if($)window.WebflowSchedulerFix={getStoredFormData:w,buildEnhancedSchedulerUrl:W,enhanceExistingIframe:Y,config:v,init:A};z("Webflow Scheduler Fix script loaded")})();
