(()=>{(function(){let L={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},A={success:"/thank-you/success",schedule:"/thank-you/schedule"},b=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],S=["yes","true","y","1","multiple owners","multi"],I=["no","false","n","0"];function V(q){if(q==null)return"";return String(q).trim().toLowerCase()}function N(q){let Q=V(q);if(!Q)return!1;if(S.includes(Q))return!0;return Q.startsWith("yes")||Q.includes("multiple owners")||Q.includes("multi practice")||Q.includes("multi-owner")||Q.includes("multi owner")||Q.includes("multi-practice")}function D(q){let Q=V(q);if(!Q)return!1;if(I.includes(Q))return!0;return Q.startsWith("no")}function _(q,Q){if(!q)return null;for(let X of Q){if(q[X])return q[X];let j=[`0-1/${X}`,`0-2/${X}`,`0-3/${X}`];for(let W of j)if(q[W])return q[W]}return null}let w=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function Z(...q){if(w)console.log("[HubSpot Router]",...q)}let h="partnerstack_click_id",U=["ps_xid","psx_id"],E=["ps_xid","psx_id"];function F(q){try{if(!document.cookie)return null;let Q=document.cookie.split(";");for(let X of Q){let j=X.trim();if(!j)continue;if(j.startsWith(`${q}=`)){let[,W]=j.split("=");if(W)return decodeURIComponent(W)}}}catch(Q){Z(`cookie access error for ${q}:`,Q)}return null}function T(){let q=[];for(let j of E){let W=F(j);if(W)Z("Found PartnerStack ID in cookie",j+":",W),q.push(W)}try{if(window.partnerstack&&window.partnerstack.ps_xid)Z("Found PartnerStack ID in window.partnerstack:",window.partnerstack.ps_xid),q.push(window.partnerstack.ps_xid)}catch(j){Z("Partnerstack global lookup error:",j)}try{if(window.ps_xid)Z("Found PartnerStack ID in window.ps_xid:",window.ps_xid),q.push(window.ps_xid)}catch(j){Z("ps_xid global lookup error:",j)}try{U.forEach((j)=>{let W=localStorage.getItem(j);if(W)Z("Found PartnerStack ID in localStorage",j+":",W),q.push(W)})}catch(j){Z("localStorage access error for partnerstack id:",j)}try{U.forEach((j)=>{let W=sessionStorage.getItem(j);if(W)Z("Found PartnerStack ID in sessionStorage",j+":",W),q.push(W)})}catch(j){Z("sessionStorage access error for partnerstack id:",j)}let Q=F(h);if(Q&&!q.includes(Q))Z("Found PartnerStack ID in partnerstack_click_id cookie:",Q),q.push(Q);Z("All PartnerStack ID candidates:",q);let X=q.find((j)=>j&&j!=="undefined"&&j!=="null");return Z("Resolved PartnerStack ID:",X),X||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=w;let C=!1;function z(q){try{if(!q)return"";let Q=String(q);return Q.indexOf("/")!==-1?Q.split("/").pop():Q}catch(Q){return q}}function K(q){let Q={};if(!q)return Q;if(Array.isArray(q))return q.forEach((X)=>{if(!X)return;let j=X.name||X.field||"",W=z(j),$=typeof X.value==="string"?X.value:Array.isArray(X.value)?X.value[0]:X.value!=null?String(X.value):"";if(j)Q[j]=$;if(W&&W!==j)Q[W]=$}),Q;if(q.fields){let X=q.fields;if(Array.isArray(X))X.forEach((j)=>{if(!j)return;let W=j.name||j.field||"",$=z(W),J=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(W)Q[W]=J;if($&&$!==W)Q[$]=J});else if(typeof X==="object")Object.entries(X).forEach(([j,W])=>{let $=z(j),J=typeof W==="string"?W:Array.isArray(W)?W[0]:W!=null?String(W):"";if(Q[j]=J,$&&$!==j)Q[$]=J});return Q}return Object.entries(q).forEach(([X,j])=>{let W=z(X),$=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(Q[X]=$,W&&W!==X)Q[W]=$}),Q}function O(q){let Q=_(q,b),X=Q&&N(Q);if(!X)return Z("Multi-practice question not answered yes, routing to success page",{field:b.find((j)=>q[j]),value:Q,hasYes:X}),"success";return Z("Multi-practice question answered yes, routing to scheduler",{multiPracticeValue:Q}),"general"}function R(q,Q){let X=L[q]||L.general,j=new URL(X.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([J,x])=>{for(let B of x)if(Q[B]){j.searchParams.set(J,Q[B]),Z(`Mapping ${B} -> ${J}: ${Q[B]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((J)=>{if(Q[J])j.searchParams.set(J,Q[J])}),Z("Built scheduler URL:",j.toString()),j.toString()}function k(q,Q){if(Q==="success"){let $=new URLSearchParams;if(q.email)$.set("email",q.email);let J=`${A.success}${$.toString()?"?"+$.toString():""}`;Z("Redirecting to success page for soft rejection:",J);try{window.location.replace(J)}catch(x){Z("replace() failed, using href for success redirect",x),window.location.href=J}return}let X={scheduler_type:Q,formData:q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(X)),Z("Stored router data in sessionStorage")}catch($){Z("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${Q}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(q)),Z("Stored form data in localStorage for prefill")}catch($){Z("Failed to store form data in localStorage:",$)}let j=new URLSearchParams;if(q.email)j.set("email",q.email);let W=`${A.schedule}${j.toString()?"?"+j.toString():""}`;Z("Redirecting to:",W);try{window.location.replace(W)}catch($){Z("replace() failed, using href for scheduler redirect",$),window.location.href=W}}function M(q,Q={}){if(Z("Form submission detected:",q),C){Z("Routing already performed; skipping");return}C=!0;let X=T();if(X){q.partnerstack_click_id=X,q["0-1/partnerstack_click_id"]=X,q["0-2/partnerstack_click_id"]=X,q["0-3/partnerstack_click_id"]=X,Z("Injected PartnerStack ID into submission:",X);try{sessionStorage.setItem("ps_xid",X)}catch(W){Z("Failed to persist partnerstack id in sessionStorage:",W)}try{localStorage.setItem("ps_xid",X)}catch(W){Z("Failed to persist partnerstack id in localStorage:",W)}}let j=O(q);if(k(q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!q.email,has_name:!!(q.firstname||q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function g(){window._capturedFormData=window._capturedFormData||{};let q={},Q=new WeakSet;function X(W,$="change"){if(!W.name)return;let J=W.name,x=z(J),B=W.value,H=B;if(W.type==="radio"){let Y=W.closest("label");if(Y&&Y.textContent){let G=Y.textContent.replace(/\s+/g," ").trim();if(G)H=G}}if(q[J]===H)return;if(q[J]=H,J==="hs_context"||J.startsWith("hs_")||J==="guid")return;if(window._capturedFormData[J]=H,x&&x!==J)window._capturedFormData[x]=H;if(W.type==="radio"){if(window._capturedFormData[`${J}_raw`]=B,x&&x!==J)window._capturedFormData[`${x}_raw`]=B;let Y=document.querySelector(`input[type="hidden"][name="${J}"]`);if(Y&&Y.value){if(window._capturedFormData[J]=Y.value,x&&x!==J)window._capturedFormData[x]=Y.value;H=Y.value}}if(H){let Y=W.type||W.tagName.toLowerCase();if(W.type==="tel"||J.toLowerCase().includes("phone")){let G=H.replace(/[\s\-\(\)\.]/g,"");if(G)window._capturedFormData[J+"_clean"]=G;Z("Captured phone:",J,"=",H)}else if(W.type==="radio")Z("Captured radio selection:",J,"=",H,"(raw:",B,")");else if(W.type==="hidden"){if(J==="hs_context"||J.startsWith("hs_")||J==="guid")return;if(W.closest(".hsfc-DropdownField"))Z("Captured dropdown:",J,"=",H);else Z("Captured field:",J,"=",H)}else Z("Captured",Y+":",J,"=",H)}}function j(){let W=new MutationObserver((J)=>{let x=[];if(J.forEach((B)=>{B.addedNodes.forEach((H)=>{if(H.nodeType===1)x.push(H)})}),x.length===0)return;x.forEach((B)=>{let H=B.querySelectorAll?B.querySelectorAll("input[name], select[name], textarea[name]"):[];if(B.tagName&&(B.tagName==="INPUT"||B.tagName==="SELECT"||B.tagName==="TEXTAREA")&&B.name)$(B);H.forEach((Y)=>$(Y))})});function $(J){if(Q.has(J))return;if(Q.add(J),J.readOnly&&J.type!=="hidden")return;if(J.type==="hidden"&&J.name){let x=J.value,B=setInterval(()=>{if(J.value!==x)x=J.value,X(J,"programmatic");if(!document.body.contains(J))clearInterval(B)},500);if(J.value)X(J,"initial")}else if(J.type==="radio")J.addEventListener("change",()=>X(J));else if(J.type==="tel"||J.name&&J.name.toLowerCase().includes("phone"))J.addEventListener("blur",()=>X(J)),J.addEventListener("change",()=>X(J));else if(J.addEventListener("change",()=>X(J)),J.addEventListener("blur",()=>X(J)),J.value)X(J,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach($),W.observe(document.body,{childList:!0,subtree:!0}),Z("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j);else j()}function v(q){if(!q)return!1;let Q=!!_(q,b);return Boolean(q.email||q.firstname||q.first_name||q.lastname||q.last_name||q.company||q.practice_name)||Q}function y(q={}){Z("Initializing postMessage listener"),window.addEventListener("message",function(Q){if(!function(J){try{let x=new URL(J).hostname;return x.endsWith("hubspot.com")||x.endsWith("hsforms.com")||x.endsWith("hsforms.net")||x.endsWith("hsappstatic.net")||x.includes("hubspot")||x.includes("hsforms")}catch(x){return!1}}(Q.origin))return;let j=Q.data;if(typeof j==="string")try{j=JSON.parse(j)}catch(J){}Z("Received message from HubSpot:",j);let W=j&&(j.type||j.messageType),$=j&&j.eventName;if(j&&W==="hsFormCallback"&&($==="onFormSubmitted"||$==="onFormSubmit")){let J=j&&j.data?K(j.data):{},B={...window._capturedFormData&&typeof window._capturedFormData==="object"?window._capturedFormData:{},...J};if(!v(B)){if($==="onFormSubmit")Z("onFormSubmit received without routing fields; waiting for onFormSubmitted event");else Z("Submission payload lacks routing data; skipping redirect");return}try{window._capturedFormData={...B}}catch(Y){Z("Failed to persist merged submission data globally:",Y)}let H={...q,formGuid:j.data?.formGuid||j.formGuid,portalId:j.data?.portalId||j.portalId};M(B,H)}else if(j&&j.formGuid&&j.accepted===!0){if(Z("Developer embed submission detected"),Z("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),Z("Stored captured form data in localStorage for prefill")}catch(x){Z("Failed to store captured form data in localStorage:",x)}let J={...q,formGuid:j.formGuid,portalId:j.portalId};M(window._capturedFormData,J)}}else if(j&&W==="hsFormCallback"&&w)Z("Ignoring hsFormCallback event:",$)}),Z("PostMessage listener initialized")}function P(q={}){let X={...{redirect:!0,debug:w},...q};if(X.debug)window.HubSpotRouterDebug={config:L,determineSchedulerType:O,buildSchedulerUrl:R,handleFormSubmission:M},Z("Debug mode enabled. Access via window.HubSpotRouterDebug");g(),y(X),Z("HubSpot Form Router initialized with config:",X)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>P());else P();window.HubSpotRouter={...window.HubSpotRouter,init:P,handleFormSubmission:M,determineSchedulerType:O,buildSchedulerUrl:R,config:L,DEBUG:w},Z("HubSpot Form Router loaded")})();})();
