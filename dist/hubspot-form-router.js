(function(){let z={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},h={success:"/thank-you/success",schedule:"/thank-you/schedule"},F=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],C=["is_your_2025_expected_annual_revenue_over__25_000_"],g=["yes","true","y","1","multiple owners","multi"],N=["no","false","n","0","less than 25000","less than 25,000","less than $25,000","under 25k","under $25,000","under 25000","no - less than $25,000"];function _(q){if(q==null)return"";return String(q).trim().toLowerCase()}function S(q){let J=_(q);if(!J)return!1;if(g.includes(J))return!0;return J.startsWith("yes")||J.includes("multiple owners")||J.includes("multi practice")||J.includes("multi-owner")||J.includes("multi owner")||J.includes("multi-practice")}function c(q){let J=_(q);if(!J)return!1;if(N.includes(J))return!0;return J.startsWith("no")||J.includes("less than")||J.includes("under 25")||J.includes("under $25")||J.includes("under25")}function A(q,J){if(!q)return null;for(let W of J){if(q[W])return q[W];let j=[`0-1/${W}`,`0-2/${W}`,`0-3/${W}`];for(let Q of j)if(q[Q])return q[Q]}return null}let M=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function $(...q){if(M)console.log("[HubSpot Router]",...q)}let w="partnerstack_click_id",V=[w,"ps_xid","psx_id"],T=["ps_xid","psx_id"];function K(q){try{if(!document.cookie)return null;let J=document.cookie.split(";");for(let W of J){let j=W.trim();if(!j)continue;if(j.startsWith(`${q}=`)){let[,Q]=j.split("=");if(Q)return decodeURIComponent(Q)}}}catch(J){$(`cookie access error for ${q}:`,J)}return null}function k(q){if(!q)return;let J=V.flatMap((j)=>[`input[name="${j}"]`,`input[name$="/${j}"]`]);if(J.length===0)return;let W;try{W=document.querySelectorAll(J.join(", "))}catch(j){$("Failed to query partnerstack inputs:",j);return}if(!W||W.length===0)return;window._capturedFormData=window._capturedFormData||{},W.forEach((j)=>{if(!j||typeof j.name!=="string")return;if(!j.value)j.value=q;window._capturedFormData[j.name]=j.value;let Q=b(j.name);if(Q&&Q!==j.name)window._capturedFormData[Q]=j.value;$("Prefilled partnerstack id field:",j.name,"=",j.value)})}function O(){let q=[];for(let j of T){let Q=K(j);if(Q)q.push(Q)}try{if(window.partnerstack&&window.partnerstack.ps_xid)q.push(window.partnerstack.ps_xid)}catch(j){$("Partnerstack global lookup error:",j)}try{if(window.ps_xid)q.push(window.ps_xid)}catch(j){$("ps_xid global lookup error:",j)}try{V.forEach((j)=>{let Q=localStorage.getItem(j);if(Q)q.push(Q)})}catch(j){$("localStorage access error for partnerstack id:",j)}try{V.forEach((j)=>{let Q=sessionStorage.getItem(j);if(Q)q.push(Q)})}catch(j){$("sessionStorage access error for partnerstack id:",j)}let J=K(w);if(J&&!q.includes(J))q.push(J);return q.find((j)=>j&&j!=="undefined"&&j!=="null")||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=M;let R=!1;function b(q){try{if(!q)return"";let J=String(q);return J.indexOf("/")!==-1?J.split("/").pop():J}catch(J){return q}}function v(q){let J={};if(!q)return J;if(Array.isArray(q))return q.forEach((W)=>{if(!W)return;let j=W.name||W.field||"",Q=b(j),x=typeof W.value==="string"?W.value:Array.isArray(W.value)?W.value[0]:W.value!=null?String(W.value):"";if(j)J[j]=x;if(Q&&Q!==j)J[Q]=x}),J;if(q.fields){let W=q.fields;if(Array.isArray(W))W.forEach((j)=>{if(!j)return;let Q=j.name||j.field||"",x=b(Q),Z=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(Q)J[Q]=Z;if(x&&x!==Q)J[x]=Z});else if(typeof W==="object")Object.entries(W).forEach(([j,Q])=>{let x=b(j),Z=typeof Q==="string"?Q:Array.isArray(Q)?Q[0]:Q!=null?String(Q):"";if(J[j]=Z,x&&x!==j)J[x]=Z});return J}return Object.entries(q).forEach(([W,j])=>{let Q=b(W),x=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(J[W]=x,Q&&Q!==W)J[Q]=x}),J}function L(q){let J=A(q,F),W=J&&S(J),j=A(q,C),Q=j&&S(j);if(!W)return $("Multi-practice question not answered yes, routing to success page",{field:F.find((x)=>q[x]),value:J,hasYes:W}),"success";if(!Q)return $("Income threshold question not answered yes, routing to success page",{field:C.find((x)=>q[x]),value:j,hasYes:Q}),"success";return $("Both income and multi-practice questions answered yes, routing to scheduler",{multiPracticeValue:J,incomeValue:j}),"general"}function I(q,J){let W=z[q]||z.general,j=new URL(W.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([Z,X])=>{for(let Y of X)if(J[Y]){j.searchParams.set(Z,J[Y]),$(`Mapping ${Y} -> ${Z}: ${J[Y]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((Z)=>{if(J[Z])j.searchParams.set(Z,J[Z])}),$("Built scheduler URL:",j.toString()),j.toString()}function E(q,J){if(J==="success"){let x=new URLSearchParams;if(q.email)x.set("email",q.email);let Z=`${h.success}${x.toString()?"?"+x.toString():""}`;$("Redirecting to success page for soft rejection:",Z),window.location.href=Z;return}let W={scheduler_type:J,formData:q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(W)),$("Stored router data in sessionStorage")}catch(x){$("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${J}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(q)),$("Stored form data in localStorage for prefill")}catch(x){$("Failed to store form data in localStorage:",x)}let j=new URLSearchParams;if(q.email)j.set("email",q.email);let Q=`${h.schedule}${j.toString()?"?"+j.toString():""}`;$("Redirecting to:",Q),window.location.href=Q}function U(q,J={}){if($("Form submission detected:",q),R){$("Routing already performed; skipping");return}R=!0;let W=O();if(W){if(!q[w])q[w]=W;try{sessionStorage.setItem(w,W)}catch(Q){$("Failed to persist partnerstack id in sessionStorage:",Q)}try{localStorage.setItem(w,W)}catch(Q){$("Failed to persist partnerstack id in localStorage:",Q)}}let j=L(q);if(E(q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!q.email,has_name:!!(q.firstname||q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function y(){window._capturedFormData=window._capturedFormData||{};let q={},J=new WeakSet;function W(Q,x="change"){if(!Q.name)return;let Z=Q.name,X=b(Z),Y=Q.value,B=Y;if(Q.type==="radio"){let H=Q.closest("label");if(H&&H.textContent){let G=H.textContent.replace(/\s+/g," ").trim();if(G)B=G}}if(q[Z]===B)return;if(q[Z]=B,Z==="hs_context"||Z.startsWith("hs_")||Z==="guid")return;if(window._capturedFormData[Z]=B,X&&X!==Z)window._capturedFormData[X]=B;if(Q.type==="radio"){if(window._capturedFormData[`${Z}_raw`]=Y,X&&X!==Z)window._capturedFormData[`${X}_raw`]=Y}if(B){let H=Q.type||Q.tagName.toLowerCase();if(Q.type==="tel"||Z.toLowerCase().includes("phone")){let G=B.replace(/[\s\-\(\)\.]/g,"");if(G)window._capturedFormData[Z+"_clean"]=G;$("Captured phone:",Z,"=",B)}else if(Q.type==="radio")$("Captured radio selection:",Z,"=",B,"(raw:",Y,")");else if(Q.type==="hidden"){if(Z==="hs_context"||Z.startsWith("hs_")||Z==="guid")return;if(Q.closest(".hsfc-DropdownField"))$("Captured dropdown:",Z,"=",B);else $("Captured field:",Z,"=",B)}else $("Captured",H+":",Z,"=",B)}}function j(){let Q=O();if(Q)k(Q);let x=new MutationObserver((X)=>{let Y=[];if(X.forEach((B)=>{B.addedNodes.forEach((H)=>{if(H.nodeType===1)Y.push(H)})}),Y.length===0)return;Y.forEach((B)=>{let H=B.querySelectorAll?B.querySelectorAll("input[name], select[name], textarea[name]"):[];if(B.tagName&&(B.tagName==="INPUT"||B.tagName==="SELECT"||B.tagName==="TEXTAREA")&&B.name)Z(B);H.forEach((G)=>Z(G))})});function Z(X){if(J.has(X))return;if(J.add(X),X.readOnly&&X.type!=="hidden")return;let Y=X.name?b(X.name):"";if((X.name===w||Y===w)&&!X.value){let B=O();if(B)X.value=B,W(X,"partnerstack_prefill")}if(X.type==="hidden"&&X.name){let B=X.value,H=setInterval(()=>{if(X.value!==B)B=X.value,W(X,"programmatic");if(!document.body.contains(X))clearInterval(H)},500);if(X.value)W(X,"initial");else{let G=O();if(G&&(X.name===w||b(X.name)===w))X.value=G,W(X,"partnerstack_prefill_hidden")}}else if(X.type==="radio")X.addEventListener("change",()=>W(X));else if(X.type==="tel"||X.name&&X.name.toLowerCase().includes("phone"))X.addEventListener("blur",()=>W(X)),X.addEventListener("change",()=>W(X));else if(X.addEventListener("change",()=>W(X)),X.addEventListener("blur",()=>W(X)),X.value)W(X,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(Z),x.observe(document.body,{childList:!0,subtree:!0}),$("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j);else j()}function D(q={}){$("Initializing postMessage listener"),window.addEventListener("message",function(J){if(!function(Z){try{let X=new URL(Z).hostname;return X.endsWith("hubspot.com")||X.endsWith("hsforms.com")||X.endsWith("hsforms.net")||X.endsWith("hsappstatic.net")||X.includes("hubspot")||X.includes("hsforms")}catch(X){return!1}}(J.origin))return;let j=J.data;if(typeof j==="string")try{j=JSON.parse(j)}catch(Z){}$("Received message from HubSpot:",j);let Q=j&&(j.type||j.messageType),x=j&&j.eventName;if(j&&Q==="hsFormCallback"&&(x==="onFormSubmitted"||x==="onFormSubmit")){let Z=j.data;if(Z){let X=v(Z);U(X,q)}}else if(j&&j.formGuid&&j.accepted===!0){if($("Developer embed submission detected"),$("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),$("Stored captured form data in localStorage for prefill")}catch(Z){$("Failed to store captured form data in localStorage:",Z)}U(window._capturedFormData,q)}}else if(j&&Q==="hsFormCallback"&&M)$("Ignoring hsFormCallback event:",x)}),$("PostMessage listener initialized")}function P(q={}){let W={...{redirect:!0,debug:M},...q};if(W.debug)window.HubSpotRouterDebug={config:z,determineSchedulerType:L,buildSchedulerUrl:I,handleFormSubmission:U},$("Debug mode enabled. Access via window.HubSpotRouterDebug");y(),D(W),$("HubSpot Form Router initialized with config:",W)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>P());else P();window.HubSpotRouter={...window.HubSpotRouter,init:P,handleFormSubmission:U,determineSchedulerType:L,buildSchedulerUrl:I,config:z,DEBUG:M},$("HubSpot Form Router loaded")})();
