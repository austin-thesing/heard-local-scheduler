(function(){let H={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},V={success:"/thank-you/success",schedule:"/thank-you/schedule"},L=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],P=["is_your_2025_expected_annual_revenue_over__25_000_"],k=["yes","true","y","1","multiple owners","multi"],I=["no","false","n","0","less than 25000","less than 25,000","less than $25,000","under 25k","under $25,000","under 25000","no - less than $25,000"];function U(Q){if(Q==null)return"";return String(Q).trim().toLowerCase()}function F(Q){let W=U(Q);if(!W)return!1;if(k.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function E(Q){let W=U(Q);if(!W)return!1;if(I.includes(W))return!0;return W.startsWith("no")||W.includes("less than")||W.includes("under 25")||W.includes("under $25")||W.includes("under25")}function C(Q,W){if(!Q)return null;for(let q of W){if(Q[q])return Q[q];let j=[`0-1/${q}`,`0-2/${q}`,`0-3/${q}`];for(let X of j)if(Q[X])return Q[X]}return null}let b=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function $(...Q){if(b)console.log("[HubSpot Router]",...Q)}let w="partnerstack_click_id",K=[w,"ps_xid"];function h(){let Q=[];try{if(window.partnerstack&&window.partnerstack.ps_xid)Q.push(window.partnerstack.ps_xid)}catch(q){$("Partnerstack global lookup error:",q)}try{if(window.ps_xid)Q.push(window.ps_xid)}catch(q){$("ps_xid global lookup error:",q)}try{K.forEach((q)=>{let j=localStorage.getItem(q);if(j)Q.push(j)})}catch(q){$("localStorage access error for partnerstack id:",q)}try{K.forEach((q)=>{let j=sessionStorage.getItem(q);if(j)Q.push(j)})}catch(q){$("sessionStorage access error for partnerstack id:",q)}try{let q=document.cookie.split(";").map((j)=>j.trim()).find((j)=>j.startsWith(`${w}=`));if(q){let[,j]=q.split("=");if(j)Q.push(decodeURIComponent(j))}}catch(q){$("cookie access error for partnerstack id:",q)}return Q.find((q)=>q&&q!=="undefined"&&q!=="null")||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=b;let _=!1;function G(Q){try{if(!Q)return"";let W=String(Q);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return Q}}function R(Q){let W={};if(!Q)return W;if(Array.isArray(Q))return Q.forEach((q)=>{if(!q)return;let j=q.name||q.field||"",X=G(j),x=typeof q.value==="string"?q.value:Array.isArray(q.value)?q.value[0]:q.value!=null?String(q.value):"";if(j)W[j]=x;if(X&&X!==j)W[X]=x}),W;if(Q.fields){let q=Q.fields;if(Array.isArray(q))q.forEach((j)=>{if(!j)return;let X=j.name||j.field||"",x=G(X),J=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(X)W[X]=J;if(x&&x!==X)W[x]=J});else if(typeof q==="object")Object.entries(q).forEach(([j,X])=>{let x=G(j),J=typeof X==="string"?X:Array.isArray(X)?X[0]:X!=null?String(X):"";if(W[j]=J,x&&x!==j)W[x]=J});return W}return Object.entries(Q).forEach(([q,j])=>{let X=G(q),x=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(W[q]=x,X&&X!==q)W[X]=x}),W}function O(Q){let W=C(Q,L),q=W&&F(W),j=C(Q,P),X=j&&F(j);if(!q)return $("Multi-practice question not answered yes, routing to success page",{field:L.find((x)=>Q[x]),value:W,hasYes:q}),"success";if(!X)return $("Income threshold question not answered yes, routing to success page",{field:P.find((x)=>Q[x]),value:j,hasYes:X}),"success";return $("Both income and multi-practice questions answered yes, routing to scheduler",{multiPracticeValue:W,incomeValue:j}),"general"}function A(Q,W){let q=H[Q]||H.general,j=new URL(q.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([J,Z])=>{for(let B of Z)if(W[B]){j.searchParams.set(J,W[B]),$(`Mapping ${B} -> ${J}: ${W[B]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((J)=>{if(W[J])j.searchParams.set(J,W[J])}),$("Built scheduler URL:",j.toString()),j.toString()}function S(Q,W){if(W==="success"){let x=new URLSearchParams;if(Q.email)x.set("email",Q.email);let J=`${V.success}${x.toString()?"?"+x.toString():""}`;$("Redirecting to success page for soft rejection:",J),window.location.href=J;return}let q={scheduler_type:W,formData:Q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(q)),$("Stored router data in sessionStorage")}catch(x){$("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(Q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(Q)),$("Stored form data in localStorage for prefill")}catch(x){$("Failed to store form data in localStorage:",x)}let j=new URLSearchParams;if(Q.email)j.set("email",Q.email);let X=`${V.schedule}${j.toString()?"?"+j.toString():""}`;$("Redirecting to:",X),window.location.href=X}function M(Q,W={}){if($("Form submission detected:",Q),_){$("Routing already performed; skipping");return}_=!0;let q=h();if(q){if(!Q[w])Q[w]=q;try{sessionStorage.setItem(w,q)}catch(X){$("Failed to persist partnerstack id in sessionStorage:",X)}try{localStorage.setItem(w,q)}catch(X){$("Failed to persist partnerstack id in localStorage:",X)}}let j=O(Q);if(S(Q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!Q.email,has_name:!!(Q.firstname||Q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function N(){window._capturedFormData=window._capturedFormData||{};let Q={},W=new WeakSet;function q(X,x="change"){if(!X.name)return;let{value:J,name:Z}=X;if(Q[Z]===J)return;if(Q[Z]=J,Z==="hs_context"||Z.startsWith("hs_")||Z==="guid")return;if(window._capturedFormData[Z]=J,J){let B=X.type||X.tagName.toLowerCase();if(X.type==="tel"||Z.toLowerCase().includes("phone")){let Y=J.replace(/[\s\-\(\)\.]/g,"");if(Y)window._capturedFormData[Z+"_clean"]=Y;$("Captured phone:",Z,"=",J)}else if(X.type==="radio")$("Captured radio selection:",Z,"=",J);else if(X.type==="hidden"){if(Z==="hs_context"||Z.startsWith("hs_")||Z==="guid")return;if(X.closest(".hsfc-DropdownField"))$("Captured dropdown:",Z,"=",J);else $("Captured field:",Z,"=",J)}else $("Captured",B+":",Z,"=",J)}}function j(){let X=new MutationObserver((J)=>{let Z=[];if(J.forEach((B)=>{B.addedNodes.forEach((Y)=>{if(Y.nodeType===1)Z.push(Y)})}),Z.length===0)return;Z.forEach((B)=>{let Y=B.querySelectorAll?B.querySelectorAll("input[name], select[name], textarea[name]"):[];if(B.tagName&&(B.tagName==="INPUT"||B.tagName==="SELECT"||B.tagName==="TEXTAREA")&&B.name)x(B);Y.forEach((g)=>x(g))})});function x(J){if(W.has(J))return;if(W.add(J),J.readOnly&&J.type!=="hidden")return;if(J.name===w&&!J.value){let Z=h();if(Z)J.value=Z,q(J,"partnerstack_prefill")}if(J.type==="hidden"&&J.name){let Z=J.value,B=setInterval(()=>{if(J.value!==Z)Z=J.value,q(J,"programmatic");if(!document.body.contains(J))clearInterval(B)},500);if(J.value)q(J,"initial")}else if(J.type==="radio")J.addEventListener("change",()=>q(J));else if(J.type==="tel"||J.name&&J.name.toLowerCase().includes("phone"))J.addEventListener("blur",()=>q(J)),J.addEventListener("change",()=>q(J));else if(J.addEventListener("change",()=>q(J)),J.addEventListener("blur",()=>q(J)),J.value)q(J,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(x),X.observe(document.body,{childList:!0,subtree:!0}),$("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j);else j()}function T(Q={}){$("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function(J){try{let Z=new URL(J).hostname;return Z.endsWith("hubspot.com")||Z.endsWith("hsforms.com")||Z.endsWith("hsforms.net")||Z.endsWith("hsappstatic.net")||Z.includes("hubspot")||Z.includes("hsforms")}catch(Z){return!1}}(W.origin))return;let j=W.data;if(typeof j==="string")try{j=JSON.parse(j)}catch(J){}$("Received message from HubSpot:",j);let X=j&&(j.type||j.messageType),x=j&&j.eventName;if(j&&X==="hsFormCallback"&&(x==="onFormSubmitted"||x==="onFormSubmit")){let J=j.data;if(J){let Z=R(J);M(Z,Q)}}else if(j&&j.formGuid&&j.accepted===!0){if($("Developer embed submission detected"),$("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),$("Stored captured form data in localStorage for prefill")}catch(J){$("Failed to store captured form data in localStorage:",J)}M(window._capturedFormData,Q)}}else if(j&&X==="hsFormCallback"&&b)$("Ignoring hsFormCallback event:",x)}),$("PostMessage listener initialized")}function z(Q={}){let q={...{redirect:!0,debug:b},...Q};if(q.debug)window.HubSpotRouterDebug={config:H,determineSchedulerType:O,buildSchedulerUrl:A,handleFormSubmission:M},$("Debug mode enabled. Access via window.HubSpotRouterDebug");N(),T(q),$("HubSpot Form Router initialized with config:",q)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>z());else z();window.HubSpotRouter={...window.HubSpotRouter,init:z,handleFormSubmission:M,determineSchedulerType:O,buildSchedulerUrl:A,config:H,DEBUG:b},$("HubSpot Form Router loaded")})();
