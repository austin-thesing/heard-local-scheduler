(function(){let M={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},U={success:"/thank-you/success",schedule:"/thank-you/schedule"},P=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],C=["is_your_2025_expected_annual_revenue_over__25_000_"],I=["yes","true","y","1","multiple owners","multi"],R=["no","false","n","0","less than 25000","less than 25,000","less than $25,000","under 25k","under $25,000","under 25000","no - less than $25,000"];function F(Q){if(Q==null)return"";return String(Q).trim().toLowerCase()}function h(Q){let W=F(Q);if(!W)return!1;if(I.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function E(Q){let W=F(Q);if(!W)return!1;if(R.includes(W))return!0;return W.startsWith("no")||W.includes("less than")||W.includes("under 25")||W.includes("under $25")||W.includes("under25")}function _(Q,W){if(!Q)return null;for(let J of W){if(Q[J])return Q[J];let j=[`0-1/${J}`,`0-2/${J}`,`0-3/${J}`];for(let X of j)if(Q[X])return Q[X]}return null}let H=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function Z(...Q){if(H)console.log("[HubSpot Router]",...Q)}let w="partnerstack_click_id",z=[w,"ps_xid"];function K(){let Q=[];try{if(window.partnerstack&&window.partnerstack.ps_xid)Q.push(window.partnerstack.ps_xid)}catch(J){Z("Partnerstack global lookup error:",J)}try{if(window.ps_xid)Q.push(window.ps_xid)}catch(J){Z("ps_xid global lookup error:",J)}try{z.forEach((J)=>{let j=localStorage.getItem(J);if(j)Q.push(j)})}catch(J){Z("localStorage access error for partnerstack id:",J)}try{z.forEach((J)=>{let j=sessionStorage.getItem(J);if(j)Q.push(j)})}catch(J){Z("sessionStorage access error for partnerstack id:",J)}try{let J=document.cookie.split(";").map((j)=>j.trim()).filter(Boolean);z.forEach((j)=>{let X=J.find((q)=>q.startsWith(`${j}=`));if(!X)return;let[,$]=X.split("=");if($)Q.push(decodeURIComponent($))})}catch(J){Z("cookie access error for partnerstack id:",J)}return Q.find((J)=>J&&J!=="undefined"&&J!=="null")||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=H;let A=!1;function b(Q){try{if(!Q)return"";let W=String(Q);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return Q}}function S(Q){let W={};if(!Q)return W;if(Array.isArray(Q))return Q.forEach((J)=>{if(!J)return;let j=J.name||J.field||"",X=b(j),$=typeof J.value==="string"?J.value:Array.isArray(J.value)?J.value[0]:J.value!=null?String(J.value):"";if(j)W[j]=$;if(X&&X!==j)W[X]=$}),W;if(Q.fields){let J=Q.fields;if(Array.isArray(J))J.forEach((j)=>{if(!j)return;let X=j.name||j.field||"",$=b(X),q=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(X)W[X]=q;if($&&$!==X)W[$]=q});else if(typeof J==="object")Object.entries(J).forEach(([j,X])=>{let $=b(j),q=typeof X==="string"?X:Array.isArray(X)?X[0]:X!=null?String(X):"";if(W[j]=q,$&&$!==j)W[$]=q});return W}return Object.entries(Q).forEach(([J,j])=>{let X=b(J),$=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(W[J]=$,X&&X!==J)W[X]=$}),W}function V(Q){let W=_(Q,P),J=W&&h(W),j=_(Q,C),X=j&&h(j);if(!J)return Z("Multi-practice question not answered yes, routing to success page",{field:P.find(($)=>Q[$]),value:W,hasYes:J}),"success";if(!X)return Z("Income threshold question not answered yes, routing to success page",{field:C.find(($)=>Q[$]),value:j,hasYes:X}),"success";return Z("Both income and multi-practice questions answered yes, routing to scheduler",{multiPracticeValue:W,incomeValue:j}),"general"}function k(Q,W){let J=M[Q]||M.general,j=new URL(J.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([q,x])=>{for(let B of x)if(W[B]){j.searchParams.set(q,W[B]),Z(`Mapping ${B} -> ${q}: ${W[B]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((q)=>{if(W[q])j.searchParams.set(q,W[q])}),Z("Built scheduler URL:",j.toString()),j.toString()}function N(Q,W){if(W==="success"){let $=new URLSearchParams;if(Q.email)$.set("email",Q.email);let q=`${U.success}${$.toString()?"?"+$.toString():""}`;Z("Redirecting to success page for soft rejection:",q),window.location.href=q;return}let J={scheduler_type:W,formData:Q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(J)),Z("Stored router data in sessionStorage")}catch($){Z("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(Q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(Q)),Z("Stored form data in localStorage for prefill")}catch($){Z("Failed to store form data in localStorage:",$)}let j=new URLSearchParams;if(Q.email)j.set("email",Q.email);let X=`${U.schedule}${j.toString()?"?"+j.toString():""}`;Z("Redirecting to:",X),window.location.href=X}function O(Q,W={}){if(Z("Form submission detected:",Q),A){Z("Routing already performed; skipping");return}A=!0;let J=K();if(J){if(!Q[w])Q[w]=J;try{sessionStorage.setItem(w,J)}catch(X){Z("Failed to persist partnerstack id in sessionStorage:",X)}try{localStorage.setItem(w,J)}catch(X){Z("Failed to persist partnerstack id in localStorage:",X)}}let j=V(Q);if(N(Q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!Q.email,has_name:!!(Q.firstname||Q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function g(){window._capturedFormData=window._capturedFormData||{};let Q={},W=new WeakSet;function J(X,$="change"){if(!X.name)return;let{value:q,name:x}=X,B=b(x);if(Q[x]===q)return;if(Q[x]=q,x==="hs_context"||x.startsWith("hs_")||x==="guid")return;if(window._capturedFormData[x]=q,B&&B!==x)window._capturedFormData[B]=q;if(q){let Y=X.type||X.tagName.toLowerCase();if(X.type==="tel"||x.toLowerCase().includes("phone")){let G=q.replace(/[\s\-\(\)\.]/g,"");if(G)window._capturedFormData[x+"_clean"]=G;Z("Captured phone:",x,"=",q)}else if(X.type==="radio")Z("Captured radio selection:",x,"=",q);else if(X.type==="hidden"){if(x==="hs_context"||x.startsWith("hs_")||x==="guid")return;if(X.closest(".hsfc-DropdownField"))Z("Captured dropdown:",x,"=",q);else Z("Captured field:",x,"=",q)}else Z("Captured",Y+":",x,"=",q)}}function j(){let X=new MutationObserver((q)=>{let x=[];if(q.forEach((B)=>{B.addedNodes.forEach((Y)=>{if(Y.nodeType===1)x.push(Y)})}),x.length===0)return;x.forEach((B)=>{let Y=B.querySelectorAll?B.querySelectorAll("input[name], select[name], textarea[name]"):[];if(B.tagName&&(B.tagName==="INPUT"||B.tagName==="SELECT"||B.tagName==="TEXTAREA")&&B.name)$(B);Y.forEach((G)=>$(G))})});function $(q){if(W.has(q))return;if(W.add(q),q.readOnly&&q.type!=="hidden")return;let x=q.name?b(q.name):"";if((q.name===w||x===w)&&!q.value){let B=K();if(B)q.value=B,J(q,"partnerstack_prefill")}if(q.type==="hidden"&&q.name){let B=q.value,Y=setInterval(()=>{if(q.value!==B)B=q.value,J(q,"programmatic");if(!document.body.contains(q))clearInterval(Y)},500);if(q.value)J(q,"initial")}else if(q.type==="radio")q.addEventListener("change",()=>J(q));else if(q.type==="tel"||q.name&&q.name.toLowerCase().includes("phone"))q.addEventListener("blur",()=>J(q)),q.addEventListener("change",()=>J(q));else if(q.addEventListener("change",()=>J(q)),q.addEventListener("blur",()=>J(q)),q.value)J(q,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach($),X.observe(document.body,{childList:!0,subtree:!0}),Z("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j);else j()}function T(Q={}){Z("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function(q){try{let x=new URL(q).hostname;return x.endsWith("hubspot.com")||x.endsWith("hsforms.com")||x.endsWith("hsforms.net")||x.endsWith("hsappstatic.net")||x.includes("hubspot")||x.includes("hsforms")}catch(x){return!1}}(W.origin))return;let j=W.data;if(typeof j==="string")try{j=JSON.parse(j)}catch(q){}Z("Received message from HubSpot:",j);let X=j&&(j.type||j.messageType),$=j&&j.eventName;if(j&&X==="hsFormCallback"&&($==="onFormSubmitted"||$==="onFormSubmit")){let q=j.data;if(q){let x=S(q);O(x,Q)}}else if(j&&j.formGuid&&j.accepted===!0){if(Z("Developer embed submission detected"),Z("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),Z("Stored captured form data in localStorage for prefill")}catch(q){Z("Failed to store captured form data in localStorage:",q)}O(window._capturedFormData,Q)}}else if(j&&X==="hsFormCallback"&&H)Z("Ignoring hsFormCallback event:",$)}),Z("PostMessage listener initialized")}function L(Q={}){let J={...{redirect:!0,debug:H},...Q};if(J.debug)window.HubSpotRouterDebug={config:M,determineSchedulerType:V,buildSchedulerUrl:k,handleFormSubmission:O},Z("Debug mode enabled. Access via window.HubSpotRouterDebug");g(),T(J),Z("HubSpot Form Router initialized with config:",J)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>L());else L();window.HubSpotRouter={...window.HubSpotRouter,init:L,handleFormSubmission:O,determineSchedulerType:V,buildSchedulerUrl:k,config:M,DEBUG:H},Z("HubSpot Form Router loaded")})();
