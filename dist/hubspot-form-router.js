(function(){let M={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},h={success:"/thank-you/success",schedule:"/thank-you/schedule"},C=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],_=["is_your_2025_expected_annual_revenue_over__25_000_"],N=["yes","true","y","1","multiple owners","multi"],T=["no","false","n","0","less than 25000","less than 25,000","less than $25,000","under 25k","under $25,000","under 25000","no - less than $25,000"];function S(q){if(q==null)return"";return String(q).trim().toLowerCase()}function K(q){let W=S(q);if(!W)return!1;if(N.includes(W))return!0;return W.startsWith("yes")||W.includes("multiple owners")||W.includes("multi practice")||W.includes("multi-owner")||W.includes("multi owner")||W.includes("multi-practice")}function c(q){let W=S(q);if(!W)return!1;if(T.includes(W))return!0;return W.startsWith("no")||W.includes("less than")||W.includes("under 25")||W.includes("under $25")||W.includes("under25")}function A(q,W){if(!q)return null;for(let X of W){if(q[X])return q[X];let j=[`0-1/${X}`,`0-2/${X}`,`0-3/${X}`];for(let J of j)if(q[J])return q[J]}return null}let G=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function Z(...q){if(G)console.log("[HubSpot Router]",...q)}let w="partnerstack_click_id",O=[w,"ps_xid"],R="ps_xid";function U(q){try{if(!document.cookie)return null;let W=document.cookie.split(";");for(let X of W){let j=X.trim();if(!j)continue;if(j.startsWith(`${q}=`)){let[,J]=j.split("=");if(J)return decodeURIComponent(J)}}}catch(W){Z(`cookie access error for ${q}:`,W)}return null}function k(q){if(!q)return;let W=O.flatMap((j)=>[`input[name="${j}"]`,`input[name$="/${j}"]`]);if(W.length===0)return;let X;try{X=document.querySelectorAll(W.join(", "))}catch(j){Z("Failed to query partnerstack inputs:",j);return}if(!X||X.length===0)return;window._capturedFormData=window._capturedFormData||{},X.forEach((j)=>{if(!j||typeof j.name!=="string")return;if(!j.value)j.value=q;window._capturedFormData[j.name]=j.value;let J=Y(j.name);if(J&&J!==j.name)window._capturedFormData[J]=j.value;Z("Prefilled partnerstack id field:",j.name,"=",j.value)})}function L(){let q=[],W=U(R);if(W)q.push(W);try{if(window.partnerstack&&window.partnerstack.ps_xid)q.push(window.partnerstack.ps_xid)}catch(J){Z("Partnerstack global lookup error:",J)}try{if(window.ps_xid)q.push(window.ps_xid)}catch(J){Z("ps_xid global lookup error:",J)}try{O.forEach((J)=>{let x=localStorage.getItem(J);if(x)q.push(x)})}catch(J){Z("localStorage access error for partnerstack id:",J)}try{O.forEach((J)=>{let x=sessionStorage.getItem(J);if(x)q.push(x)})}catch(J){Z("sessionStorage access error for partnerstack id:",J)}let X=U(w);if(X&&!q.includes(X))q.push(X);return q.find((J)=>J&&J!=="undefined"&&J!=="null")||null}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=G;let I=!1;function Y(q){try{if(!q)return"";let W=String(q);return W.indexOf("/")!==-1?W.split("/").pop():W}catch(W){return q}}function v(q){let W={};if(!q)return W;if(Array.isArray(q))return q.forEach((X)=>{if(!X)return;let j=X.name||X.field||"",J=Y(j),x=typeof X.value==="string"?X.value:Array.isArray(X.value)?X.value[0]:X.value!=null?String(X.value):"";if(j)W[j]=x;if(J&&J!==j)W[J]=x}),W;if(q.fields){let X=q.fields;if(Array.isArray(X))X.forEach((j)=>{if(!j)return;let J=j.name||j.field||"",x=Y(J),$=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(J)W[J]=$;if(x&&x!==J)W[x]=$});else if(typeof X==="object")Object.entries(X).forEach(([j,J])=>{let x=Y(j),$=typeof J==="string"?J:Array.isArray(J)?J[0]:J!=null?String(J):"";if(W[j]=$,x&&x!==j)W[x]=$});return W}return Object.entries(q).forEach(([X,j])=>{let J=Y(X),x=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(W[X]=x,J&&J!==X)W[J]=x}),W}function F(q){let W=A(q,C),X=W&&K(W),j=A(q,_),J=j&&K(j);if(!X)return Z("Multi-practice question not answered yes, routing to success page",{field:C.find((x)=>q[x]),value:W,hasYes:X}),"success";if(!J)return Z("Income threshold question not answered yes, routing to success page",{field:_.find((x)=>q[x]),value:j,hasYes:J}),"success";return Z("Both income and multi-practice questions answered yes, routing to scheduler",{multiPracticeValue:W,incomeValue:j}),"general"}function g(q,W){let X=M[q]||M.general,j=new URL(X.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([$,Q])=>{for(let b of Q)if(W[b]){j.searchParams.set($,W[b]),Z(`Mapping ${b} -> ${$}: ${W[b]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(($)=>{if(W[$])j.searchParams.set($,W[$])}),Z("Built scheduler URL:",j.toString()),j.toString()}function y(q,W){if(W==="success"){let x=new URLSearchParams;if(q.email)x.set("email",q.email);let $=`${h.success}${x.toString()?"?"+x.toString():""}`;Z("Redirecting to success page for soft rejection:",$),window.location.href=$;return}let X={scheduler_type:W,formData:q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(X)),Z("Stored router data in sessionStorage")}catch(x){Z("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${W}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(q)),Z("Stored form data in localStorage for prefill")}catch(x){Z("Failed to store form data in localStorage:",x)}let j=new URLSearchParams;if(q.email)j.set("email",q.email);let J=`${h.schedule}${j.toString()?"?"+j.toString():""}`;Z("Redirecting to:",J),window.location.href=J}function z(q,W={}){if(Z("Form submission detected:",q),I){Z("Routing already performed; skipping");return}I=!0;let X=L();if(X){if(!q[w])q[w]=X;try{sessionStorage.setItem(w,X)}catch(J){Z("Failed to persist partnerstack id in sessionStorage:",J)}try{localStorage.setItem(w,X)}catch(J){Z("Failed to persist partnerstack id in localStorage:",J)}}let j=F(q);if(y(q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!q.email,has_name:!!(q.firstname||q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function E(){window._capturedFormData=window._capturedFormData||{};let q={},W=new WeakSet;function X(J,x="change"){if(!J.name)return;let{value:$,name:Q}=J,b=Y(Q);if(q[Q]===$)return;if(q[Q]=$,Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(window._capturedFormData[Q]=$,b&&b!==Q)window._capturedFormData[b]=$;if($){let B=J.type||J.tagName.toLowerCase();if(J.type==="tel"||Q.toLowerCase().includes("phone")){let H=$.replace(/[\s\-\(\)\.]/g,"");if(H)window._capturedFormData[Q+"_clean"]=H;Z("Captured phone:",Q,"=",$)}else if(J.type==="radio")Z("Captured radio selection:",Q,"=",$);else if(J.type==="hidden"){if(Q==="hs_context"||Q.startsWith("hs_")||Q==="guid")return;if(J.closest(".hsfc-DropdownField"))Z("Captured dropdown:",Q,"=",$);else Z("Captured field:",Q,"=",$)}else Z("Captured",B+":",Q,"=",$)}}function j(){let J=U(R);if(J)k(J);let x=new MutationObserver((Q)=>{let b=[];if(Q.forEach((B)=>{B.addedNodes.forEach((H)=>{if(H.nodeType===1)b.push(H)})}),b.length===0)return;b.forEach((B)=>{let H=B.querySelectorAll?B.querySelectorAll("input[name], select[name], textarea[name]"):[];if(B.tagName&&(B.tagName==="INPUT"||B.tagName==="SELECT"||B.tagName==="TEXTAREA")&&B.name)$(B);H.forEach((V)=>$(V))})});function $(Q){if(W.has(Q))return;if(W.add(Q),Q.readOnly&&Q.type!=="hidden")return;let b=Q.name?Y(Q.name):"";if((Q.name===w||b===w)&&!Q.value){let B=L();if(B)Q.value=B,X(Q,"partnerstack_prefill")}if(Q.type==="hidden"&&Q.name){let B=Q.value,H=setInterval(()=>{if(Q.value!==B)B=Q.value,X(Q,"programmatic");if(!document.body.contains(Q))clearInterval(H)},500);if(Q.value)X(Q,"initial");else{let V=L();if(V&&(Q.name===w||Y(Q.name)===w))Q.value=V,X(Q,"partnerstack_prefill_hidden")}}else if(Q.type==="radio")Q.addEventListener("change",()=>X(Q));else if(Q.type==="tel"||Q.name&&Q.name.toLowerCase().includes("phone"))Q.addEventListener("blur",()=>X(Q)),Q.addEventListener("change",()=>X(Q));else if(Q.addEventListener("change",()=>X(Q)),Q.addEventListener("blur",()=>X(Q)),Q.value)X(Q,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach($),x.observe(document.body,{childList:!0,subtree:!0}),Z("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",j);else j()}function D(q={}){Z("Initializing postMessage listener"),window.addEventListener("message",function(W){if(!function($){try{let Q=new URL($).hostname;return Q.endsWith("hubspot.com")||Q.endsWith("hsforms.com")||Q.endsWith("hsforms.net")||Q.endsWith("hsappstatic.net")||Q.includes("hubspot")||Q.includes("hsforms")}catch(Q){return!1}}(W.origin))return;let j=W.data;if(typeof j==="string")try{j=JSON.parse(j)}catch($){}Z("Received message from HubSpot:",j);let J=j&&(j.type||j.messageType),x=j&&j.eventName;if(j&&J==="hsFormCallback"&&(x==="onFormSubmitted"||x==="onFormSubmit")){let $=j.data;if($){let Q=v($);z(Q,q)}}else if(j&&j.formGuid&&j.accepted===!0){if(Z("Developer embed submission detected"),Z("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),Z("Stored captured form data in localStorage for prefill")}catch($){Z("Failed to store captured form data in localStorage:",$)}z(window._capturedFormData,q)}}else if(j&&J==="hsFormCallback"&&G)Z("Ignoring hsFormCallback event:",x)}),Z("PostMessage listener initialized")}function P(q={}){let X={...{redirect:!0,debug:G},...q};if(X.debug)window.HubSpotRouterDebug={config:M,determineSchedulerType:F,buildSchedulerUrl:g,handleFormSubmission:z},Z("Debug mode enabled. Access via window.HubSpotRouterDebug");E(),D(X),Z("HubSpot Form Router initialized with config:",X)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>P());else P();window.HubSpotRouter={...window.HubSpotRouter,init:P,handleFormSubmission:z,determineSchedulerType:F,buildSchedulerUrl:g,config:M,DEBUG:G},Z("HubSpot Form Router loaded")})();
