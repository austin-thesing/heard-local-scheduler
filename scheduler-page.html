<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schedule Your Consultation | Heard</title>
    <link rel="stylesheet" href="form.css" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        padding: 40px;
        max-width: 1000px;
        margin: 0 auto;
        background-color: #f8f9fa;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        color: #226752;
        font-size: 32px;
        margin-bottom: 10px;
      }

      .header p {
        color: #666;
        font-size: 18px;
        margin: 0;
      }

      #scheduler-target {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        min-height: 600px;
      }

      #scheduler-target:empty {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        font-style: italic;
      }

      #scheduler-target:empty::before {
        content: "Loading your consultation scheduler...";
      }

      .debug-panel {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 4px;
        font-size: 12px;
        max-width: 300px;
        display: none;
      }

      .debug-panel.show {
        display: block;
      }

      .debug-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #226752;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Schedule Your Consultation</h1>
      <p>Let's discuss how Heard can help your practice</p>
    </div>

    <!-- This is the target element where the enhanced scheduler will be injected -->
    <div id="scheduler-target"></div>

    <!-- Debug toggle button -->
    <button class="debug-toggle" onclick="toggleDebug()">Debug</button>

    <!-- Debug panel -->
    <div id="debug-panel" class="debug-panel">
      <strong>Debug Info:</strong><br />
      <div id="debug-content">Loading...</div>
    </div>

    <!-- Load the Enhanced Scheduler -->
    <script src="scheduler-standalone.js"></script>

    <script>
      // Enable debug mode if requested
      const urlParams = new URLSearchParams(window.location.search);
      const isDebug = urlParams.has("debug") || window.location.hostname === "localhost";

      if (isDebug && !urlParams.has("debug")) {
        urlParams.set("debug", "true");
        window.history.replaceState({}, "", "?" + urlParams.toString());
      }

      function toggleDebug() {
        const panel = document.getElementById("debug-panel");
        panel.classList.toggle("show");
        updateDebugInfo();
      }

      function updateDebugInfo() {
        const debugContent = document.getElementById("debug-content");

        // Check for form data in different storage locations
        const localStorage_data = localStorage.getItem("hubspot_form_data");
        const sessionStorage_data = sessionStorage.getItem("scheduler_router_data");
        const urlParams = new URLSearchParams(window.location.search);

        let info = [];

        if (localStorage_data) {
          try {
            const data = JSON.parse(localStorage_data);
            info.push(`📁 localStorage: ${Object.keys(data).length} fields`);
          } catch (e) {
            info.push("📁 localStorage: invalid JSON");
          }
        } else {
          info.push("📁 localStorage: empty");
        }

        if (sessionStorage_data) {
          try {
            const data = JSON.parse(sessionStorage_data);
            info.push(`💾 sessionStorage: ${Object.keys(data.formData || {}).length} fields`);
          } catch (e) {
            info.push("💾 sessionStorage: invalid JSON");
          }
        } else {
          info.push("💾 sessionStorage: empty");
        }

        if (urlParams.toString()) {
          info.push(`🔗 URL params: ${urlParams.toString()}`);
        } else {
          info.push("🔗 URL params: none");
        }

        info.push(`🎯 Target: ${document.getElementById("scheduler-target").children.length > 0 ? "loaded" : "empty"}`);

        debugContent.innerHTML = info.join("<br>");
      }

      // Update debug info periodically
      setInterval(updateDebugInfo, 2000);

      // Show a message if no form data is available
      setTimeout(() => {
        const target = document.getElementById("scheduler-target");
        if (target.children.length === 0) {
          const localStorage_data = localStorage.getItem("hubspot_form_data");
          const sessionStorage_data = sessionStorage.getItem("scheduler_router_data");

          if (!localStorage_data && !sessionStorage_data) {
            target.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
              <h3>No form data found</h3>
              <p>To test the enhanced scheduler, you can:</p>
              <ol style="text-align: left; display: inline-block;">
                <li>Fill out a form on the <a href="test-embed.html?debug=true">test form page</a></li>
                <li>Use the <a href="test-enhanced-scheduler.html?debug=true">enhanced scheduler test page</a></li>
                <li>Or set form data manually in localStorage</li>
              </ol>
              <button onclick="setTestData()" style="background: #226752; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 20px;">
                Set Test Data & Reload
              </button>
            </div>
          `;
          }
        }
      }, 1000);

      function setTestData() {
        const testData = {
          firstname: "John",
          lastname: "Doe",
          email: "john.doe@example.com",
        };
        localStorage.setItem("hubspot_form_data", JSON.stringify(testData));
        window.location.reload();
      }

      console.log("[Scheduler Page] Enhanced scheduler page loaded");
      console.log("[Scheduler Page] Debug mode:", isDebug);
    </script>
  </body>
</html>
